{
  "hash": "87457a64fccfa242c3b4d2308a560d2d",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"R ggraphで全国の市町村合併を可視化する\"\nlang: ja\ncategories: [Japanese, jpcity]\ndate: 2024-05-26\nformat: html\n---\n\n\n昨日，[こちらの記事](https://uchidamizuki.quarto.pub/blog/posts/2024/05/lets-smartly-format-municipal-data-in-r.html)でjpcityパッケージを紹介しました． jpcityパッケージでは，内部的に過去の全国の市町村合併（廃置分合）をネットワーク化することで，異なる時点間での市区町村コードの対応付けを行っています．\n\nこの記事では，jpcityパッケージが内部で使用する市町村合併ネットワークを以下の方針で可視化しみます．\n\n-   1970年4月1日～2024年4月1日にかけての市町村合併や市・町制施行を都道府県ごとに可視化\n-   並び替えにおいて時系列は考慮しない（位置を時点に合わせることも可能だが見えづらいため）\n-   区の分離・分割は対象外\n\n### 参考記事\n\n-   [Rで市区町村データをスマートに整形しよう（市町村合併や政令指定都市の集計処理など）](https://uchidamizuki.quarto.pub/blog/posts/2024/05/lets-smartly-format-municipal-data-in-r.html)\n\n### 都道府県別の市町村合併の可視化結果\n\n以下に市町村合併の可視化結果を示します．データ上の不備等に気づかれた方はコメント等でお知らせいただければ幸いです．\nラベルが重なって見づらい箇所があることをご了承ください．\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nlibrary(tidyverse)\nlibrary(tidygraph)\nlibrary(ggraph)\n\ndate_end <- ymd(\"2024-04-01\")\n\ngraph_city <- jpcity:::graph_city$graph_city |> \n  \n  activate(nodes) |> \n  filter(!node_is_isolated(),\n         is.infinite(interval) | int_end(interval) <= date_end) |> \n  arrange(desc(interval)) |>\n  \n  replace_na(list(city_desig_name = \"\",\n                  city_name = \"\")) |>\n  mutate(city_name = str_c(city_desig_name, city_name)) |>\n  select(!city_desig_name) |> \n  \n  mutate(group = group_components()) |> \n  \n  activate(edges) |>\n  filter(!type %in% c(\"分離\", \"分割\"))\n\njpcity::parse_pref(1:47) |> \n  walk(\\(pref) {\n    pref_name <- jpcity::pref_name(pref)\n    \n    plot <- graph_city |> \n      activate(nodes) |> \n      filter(pref_name == .env$pref_name) |> \n      \n      create_layout(\"fabric\") |>\n      \n      # ラベル位置を時系列に合わせることも可能だが見えづらいため省略\n      # mutate(y = int_start(interval)) |>\n      \n      ggraph() +\n      geom_edge_diagonal(color = \"gray\",\n                         arrow = arrow(length = unit(2, 'mm')), \n                         end_cap = circle(8, 'mm')) +\n      geom_node_label(aes(label = city_name,\n                          fill = as_factor(group)),\n                      size = 3,\n                      show.legend = FALSE) +\n      scale_fill_hue(l = 100) +\n      coord_flip() +\n      \n      labs(title = pref_name) +\n      theme_void()\n    \n    print(plot)\n  })\n```\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-2.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-3.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-4.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-5.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-6.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-7.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-8.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-9.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-10.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-11.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-12.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-13.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-14.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-15.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-16.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-17.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-18.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-19.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-20.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-21.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-22.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-23.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-24.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-25.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-26.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-27.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-28.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-29.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-30.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-31.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-32.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-33.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-34.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-35.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-36.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-37.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-38.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-39.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-40.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-41.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-42.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-43.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-44.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-45.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-46.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](visualizing-municipal-mergers-in-japan-with-r-ggraph_files/figure-html/市町村合併の可視化-47.png){width=672}\n:::\n:::\n",
    "supporting": [
      "visualizing-municipal-mergers-in-japan-with-r-ggraph_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}