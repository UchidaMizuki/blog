{
  "hash": "7852d5324346b1602b35997d02764bcc",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Rで市区町村データをスマートに整形しよう（市町村合併や政令指定都市の集計処理など）\"\nlang: ja\ncategories: [Japanese, jpcity]\ndate: 2024-05-25\nformat: html\nimage: https://raw.githubusercontent.com/UchidaMizuki/jpcity/main/man/figures/logo.png?raw=true\n---\n\n\nこの記事は，はじめに市区町村データの分析で注意すべき点について説明し，\n次に，Rのjpcityパッケージを用いて市区町村データをスマートに整形する方法について紹介します．\n\n## 市区町村データの分析で注意すべきことは？\n\n市区町村別の統計データを分析する際には，どのようなことに気をつけるべきでしょうか．\n以下では，主な注意点を3つに絞って紹介します．\n\n### ①市区町村名の重複に注意する\n\nまず気をつけるべきことは，同じ名称をもつ市区町村名が複数存在する場合があることです． 実際に，2020年1月1日時点で漢字表記が重複する市町村は，以下のように60市町村弱存在します[^1]．\n\n[^1]: ここでは，ひらがな表記（読み方）が異なっていても漢字表記が同じであれば「重複」としてカウントしています．また，政令指定都市の区名は重複が多いので対象外としています．\n\nここで，表の一番左列`city_code`に記載されている5桁の数字は， 市区町村コード（全国地方公共団体コード）と呼ばれるもので市区町村を一意に識別するための番号です． そのため，市区町村データを分析する際には，市区町村名ではなく市区町村コードを用いて市区町村を識別することが望ましいと言えるでしょう．\n\nちなみに，市区町村コードの上2桁の数字は都道府県の識別番号であり，都道府県コードと呼ばれます．\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"市区町村名の重複箇所の抽出\"}\nlibrary(tidyverse)\nlibrary(jpcity)\n\nget_city(\"2020-01-01\") |> \n  jpcity:::city_data() |> \n  mutate(n = n(),\n         .by = c(city_desig_name, city_name)) |> \n  filter(n > 1) |> \n  arrange(desc(n), city_desig_name, city_name) |> \n  select(!c(starts_with(\"city_desig_name\"), n)) |> \n  rmarkdown::paged_table()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"city_code\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"pref_name\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"city_name\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"city_name_kana\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"01644\",\"2\":\"北海道\",\"3\":\"池田町\",\"4\":\"いけだちょう\"},{\"1\":\"18382\",\"2\":\"福井県\",\"3\":\"池田町\",\"4\":\"いけだちょう\"},{\"1\":\"20481\",\"2\":\"長野県\",\"3\":\"池田町\",\"4\":\"いけだまち\"},{\"1\":\"21404\",\"2\":\"岐阜県\",\"3\":\"池田町\",\"4\":\"いけだちょう\"},{\"1\":\"02445\",\"2\":\"青森県\",\"3\":\"南部町\",\"4\":\"なんぶちょう\"},{\"1\":\"19366\",\"2\":\"山梨県\",\"3\":\"南部町\",\"4\":\"なんぶちょう\"},{\"1\":\"31389\",\"2\":\"鳥取県\",\"3\":\"南部町\",\"4\":\"なんぶちょう\"},{\"1\":\"06323\",\"2\":\"山形県\",\"3\":\"朝日町\",\"4\":\"あさひまち\"},{\"1\":\"16343\",\"2\":\"富山県\",\"3\":\"朝日町\",\"4\":\"あさひまち\"},{\"1\":\"24343\",\"2\":\"三重県\",\"3\":\"朝日町\",\"4\":\"あさひちょう\"},{\"1\":\"18442\",\"2\":\"福井県\",\"3\":\"美浜町\",\"4\":\"みはまちょう\"},{\"1\":\"23446\",\"2\":\"愛知県\",\"3\":\"美浜町\",\"4\":\"みはまちょう\"},{\"1\":\"30381\",\"2\":\"和歌山県\",\"3\":\"美浜町\",\"4\":\"みはまちょう\"},{\"1\":\"05434\",\"2\":\"秋田県\",\"3\":\"美郷町\",\"4\":\"みさとちょう\"},{\"1\":\"32448\",\"2\":\"島根県\",\"3\":\"美郷町\",\"4\":\"みさとちょう\"},{\"1\":\"45431\",\"2\":\"宮崎県\",\"3\":\"美郷町\",\"4\":\"みさとちょう\"},{\"1\":\"04505\",\"2\":\"宮城県\",\"3\":\"美里町\",\"4\":\"みさとまち\"},{\"1\":\"11381\",\"2\":\"埼玉県\",\"3\":\"美里町\",\"4\":\"みさとまち\"},{\"1\":\"43348\",\"2\":\"熊本県\",\"3\":\"美里町\",\"4\":\"みさとまち\"},{\"1\":\"01233\",\"2\":\"北海道\",\"3\":\"伊達市\",\"4\":\"だてし\"},{\"1\":\"07213\",\"2\":\"福島県\",\"3\":\"伊達市\",\"4\":\"だてし\"},{\"1\":\"10383\",\"2\":\"群馬県\",\"3\":\"南牧村\",\"4\":\"なんもくむら\"},{\"1\":\"20305\",\"2\":\"長野県\",\"3\":\"南牧村\",\"4\":\"みなみまきむら\"},{\"1\":\"27381\",\"2\":\"大阪府\",\"3\":\"太子町\",\"4\":\"たいしちょう\"},{\"1\":\"28464\",\"2\":\"兵庫県\",\"3\":\"太子町\",\"4\":\"たいしちょう\"},{\"1\":\"06401\",\"2\":\"山形県\",\"3\":\"小国町\",\"4\":\"おぐにまち\"},{\"1\":\"43424\",\"2\":\"熊本県\",\"3\":\"小国町\",\"4\":\"おぐにまち\"},{\"1\":\"20304\",\"2\":\"長野県\",\"3\":\"川上村\",\"4\":\"かわかみむら\"},{\"1\":\"29452\",\"2\":\"奈良県\",\"3\":\"川上村\",\"4\":\"かわかみむら\"},{\"1\":\"04324\",\"2\":\"宮城県\",\"3\":\"川崎町\",\"4\":\"かわさきまち\"},{\"1\":\"40605\",\"2\":\"福岡県\",\"3\":\"川崎町\",\"4\":\"かわさきまち\"},{\"1\":\"06382\",\"2\":\"山形県\",\"3\":\"川西町\",\"4\":\"かわにしまち\"},{\"1\":\"29361\",\"2\":\"奈良県\",\"3\":\"川西町\",\"4\":\"かわにしちょう\"},{\"1\":\"30362\",\"2\":\"和歌山県\",\"3\":\"広川町\",\"4\":\"ひろがわちょう\"},{\"1\":\"40544\",\"2\":\"福岡県\",\"3\":\"広川町\",\"4\":\"ひろかわまち\"},{\"1\":\"13206\",\"2\":\"東京都\",\"3\":\"府中市\",\"4\":\"ふちゅうし\"},{\"1\":\"34208\",\"2\":\"広島県\",\"3\":\"府中市\",\"4\":\"ふちゅうし\"},{\"1\":\"25383\",\"2\":\"滋賀県\",\"3\":\"日野町\",\"4\":\"ひのちょう\"},{\"1\":\"31402\",\"2\":\"鳥取県\",\"3\":\"日野町\",\"4\":\"ひのちょう\"},{\"1\":\"01601\",\"2\":\"北海道\",\"3\":\"日高町\",\"4\":\"ひだかちょう\"},{\"1\":\"30382\",\"2\":\"和歌山県\",\"3\":\"日高町\",\"4\":\"ひだかちょう\"},{\"1\":\"10522\",\"2\":\"群馬県\",\"3\":\"明和町\",\"4\":\"めいわまち\"},{\"1\":\"24442\",\"2\":\"三重県\",\"3\":\"明和町\",\"4\":\"めいわちょう\"},{\"1\":\"07446\",\"2\":\"福島県\",\"3\":\"昭和村\",\"4\":\"しょうわむら\"},{\"1\":\"10448\",\"2\":\"群馬県\",\"3\":\"昭和村\",\"4\":\"しょうわむら\"},{\"1\":\"01331\",\"2\":\"北海道\",\"3\":\"松前町\",\"4\":\"まつまえちょう\"},{\"1\":\"38401\",\"2\":\"愛媛県\",\"3\":\"松前町\",\"4\":\"まさきちょう\"},{\"1\":\"01345\",\"2\":\"北海道\",\"3\":\"森町\",\"4\":\"もりまち\"},{\"1\":\"22461\",\"2\":\"静岡県\",\"3\":\"森町\",\"4\":\"もりまち\"},{\"1\":\"01403\",\"2\":\"北海道\",\"3\":\"泊村\",\"4\":\"とまりむら\"},{\"1\":\"01696\",\"2\":\"北海道\",\"3\":\"泊村\",\"4\":\"とまりむら\"},{\"1\":\"01636\",\"2\":\"北海道\",\"3\":\"清水町\",\"4\":\"しみずちょう\"},{\"1\":\"22341\",\"2\":\"静岡県\",\"3\":\"清水町\",\"4\":\"しみずちょう\"},{\"1\":\"06361\",\"2\":\"山形県\",\"3\":\"金山町\",\"4\":\"かねやままち\"},{\"1\":\"07445\",\"2\":\"福島県\",\"3\":\"金山町\",\"4\":\"かねやままち\"},{\"1\":\"10428\",\"2\":\"群馬県\",\"3\":\"高山村\",\"4\":\"たかやまむら\"},{\"1\":\"20543\",\"2\":\"長野県\",\"3\":\"高山村\",\"4\":\"たかやまむら\"},{\"1\":\"20403\",\"2\":\"長野県\",\"3\":\"高森町\",\"4\":\"たかもりまち\"},{\"1\":\"43428\",\"2\":\"熊本県\",\"3\":\"高森町\",\"4\":\"たかもりまち\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n### ②市町村合併（廃置分合）による市区町村コードの変更に注意する\n\n市区町村コードを使ってさえいれば問題ないのでしょうか？ 残念ながら，市区町村コードによる分析にはもう一つの落とし穴があります． それは，市町村合併（廃置分合）によって市区町村コードが変更されることがあるという点です．\n\n市区町村コードは1970年4月1日に利用が開始されましたが，その後の平成の大合併（1999年～2010年）などによって市区町村数は大きく減少しました． そのため，特に1999年～2010年ごろの市区町村データを分析する際には，別途，面倒な集計・按分処理（いわゆる廃置分合処理）が必要となることがあります．\n\n例として，1970年4月1日から2020年1月1日にかけて最も多くの市区町村が合併してできた市区町村を抽出してみましょう． 抽出の結果（下表），これまでに最も多くの市町村合併を経た市区町村は15市町村が合併してできた新潟県上越市であることがわかりました．\n\nまた，市町村合併だけでなく町制変更や市制施行などによって市区町村コードが変更されることもあります． そのため，市区町村データを分析する際には，こうした市区町村コードの変更事由や変更時期を考慮したデータ整形が必要となることがあります．\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"最も多くの市区町村が合併してできた市区町村の抽出\"}\ntibble(city_after = get_city(\"2020-01-01\"),\n       city_before = city_after |> \n         city_convert(\"2020-01-01\", \"1970-04-01\")) |> \n  mutate(size_city_before = vctrs::list_sizes(city_before)) |> \n  slice_max(size_city_before, \n            n = 1) |> \n  select(!size_city_before) |> \n  unnest(city_before) |> \n  mutate(city_code_before = city_code(city_before),\n         city_name_before = city_name(city_before),\n         city_code_after = city_code(city_after),\n         city_name_after = city_name(city_after),\n         .keep = \"unused\") |> \n  rmarkdown::paged_table()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"city_code_before\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"city_name_before\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"city_code_after\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"city_name_after\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"15203\",\"2\":\"高田市\",\"3\":\"15222\",\"4\":\"上越市\"},{\"1\":\"15214\",\"2\":\"直江津市\",\"3\":\"15222\",\"4\":\"上越市\"},{\"1\":\"15521\",\"2\":\"安塚町\",\"3\":\"15222\",\"4\":\"上越市\"},{\"1\":\"15522\",\"2\":\"浦川原村\",\"3\":\"15222\",\"4\":\"上越市\"},{\"1\":\"15525\",\"2\":\"大島村\",\"3\":\"15222\",\"4\":\"上越市\"},{\"1\":\"15526\",\"2\":\"牧村\",\"3\":\"15222\",\"4\":\"上越市\"},{\"1\":\"15541\",\"2\":\"柿崎町\",\"3\":\"15222\",\"4\":\"上越市\"},{\"1\":\"15542\",\"2\":\"大潟町\",\"3\":\"15222\",\"4\":\"上越市\"},{\"1\":\"15543\",\"2\":\"頸城村\",\"3\":\"15222\",\"4\":\"上越市\"},{\"1\":\"15544\",\"2\":\"吉川町\",\"3\":\"15222\",\"4\":\"上越市\"},{\"1\":\"15546\",\"2\":\"中郷村\",\"3\":\"15222\",\"4\":\"上越市\"},{\"1\":\"15548\",\"2\":\"板倉町\",\"3\":\"15222\",\"4\":\"上越市\"},{\"1\":\"15549\",\"2\":\"清里村\",\"3\":\"15222\",\"4\":\"上越市\"},{\"1\":\"15550\",\"2\":\"三和村\",\"3\":\"15222\",\"4\":\"上越市\"},{\"1\":\"15561\",\"2\":\"名立町\",\"3\":\"15222\",\"4\":\"上越市\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[20],\"max\":[20]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n### ③政令指定都市の市区の扱いに注意する\n\n上記の注意点を押さえれば，市区町村データの整形の山場を乗り越えたと言えるでしょう． 最後に，細かい点ではありますが，政令指定都市の市区の扱いについて取り上げておきます．\n\n統計データによっては，政令指定都市の区レベルのデータが入手可能な市区町村データではなく， 市レベルで集計した市町村データしか入手できないことがあります．\n\n政令指定都市の市と区には，それぞれに異なる市区町村コードが割り振られているため， こうした地域区分の異なるデータを統合する際には，市区町村コードの対応付けが必要となります．\n\n例として，横浜市における市と区の対応付けを下表に示します．\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"政令指定都市の市と区の対応付け\"}\ntibble(city = find_city(\"横浜市\", \"2020-01-01\") |> \n         city_desig_merge() |> \n         vctrs::vec_unique(),\n       city_desig = city |> \n         city_desig_split()) |> \n  unnest(city_desig) |> \n  mutate(city_code = city_code(city),\n         city_name = city_name(city),\n         city_desig_code = city_code(city_desig),\n         city_desig_name = city_name(city_desig),\n         .keep = \"unused\") |> \n  rmarkdown::paged_table()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"city_code\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"city_name\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"city_desig_code\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"city_desig_name\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"14100\",\"2\":\"横浜市\",\"3\":\"14101\",\"4\":\"横浜市鶴見区\"},{\"1\":\"14100\",\"2\":\"横浜市\",\"3\":\"14102\",\"4\":\"横浜市神奈川区\"},{\"1\":\"14100\",\"2\":\"横浜市\",\"3\":\"14103\",\"4\":\"横浜市西区\"},{\"1\":\"14100\",\"2\":\"横浜市\",\"3\":\"14104\",\"4\":\"横浜市中区\"},{\"1\":\"14100\",\"2\":\"横浜市\",\"3\":\"14105\",\"4\":\"横浜市南区\"},{\"1\":\"14100\",\"2\":\"横浜市\",\"3\":\"14106\",\"4\":\"横浜市保土ケ谷区\"},{\"1\":\"14100\",\"2\":\"横浜市\",\"3\":\"14107\",\"4\":\"横浜市磯子区\"},{\"1\":\"14100\",\"2\":\"横浜市\",\"3\":\"14108\",\"4\":\"横浜市金沢区\"},{\"1\":\"14100\",\"2\":\"横浜市\",\"3\":\"14109\",\"4\":\"横浜市港北区\"},{\"1\":\"14100\",\"2\":\"横浜市\",\"3\":\"14110\",\"4\":\"横浜市戸塚区\"},{\"1\":\"14100\",\"2\":\"横浜市\",\"3\":\"14111\",\"4\":\"横浜市港南区\"},{\"1\":\"14100\",\"2\":\"横浜市\",\"3\":\"14112\",\"4\":\"横浜市旭区\"},{\"1\":\"14100\",\"2\":\"横浜市\",\"3\":\"14113\",\"4\":\"横浜市緑区\"},{\"1\":\"14100\",\"2\":\"横浜市\",\"3\":\"14114\",\"4\":\"横浜市瀬谷区\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[20],\"max\":[20]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n## Rで市区町村データをスマートに整形する\n\nここまでの注意点を踏まえて，Rを用いて市区町村データをスマートに整形する方法を紹介します． 実は，上に示した事例は，いずれもe-Statの 「[市区町村を探す](https://www.e-stat.go.jp/municipalities/cities/areacode)」と 「[廃置分合等情報を探す](https://www.e-stat.go.jp/municipalities/cities/absorption-separation-of-municipalities)」で 公開されている情報に基づいています．\n\nしかし，「廃置分合等情報を探す」では，市町村合併等による市区町村コードの変更内容がテキスト形式で記載されているため， そのままではデータ整形に利用しにくいという問題があります．\n\nそこで，こうした複雑なデータ整形を行うことなく，簡単に廃置分合処理や政令指定都市の市区の対応付けを行うために， 新たに，[jpcity](https://uchidamizuki.github.io/jpcity/)パッケージを作成しました[^2]． ちなみに，上に示した表はすべてjpcityパッケージを用いて作成したものです． jpcityは，CRANに登録済みであるため，以下のコードを実行することでインストールすることができます． ここからは，jpcityの使い方について簡単に説明していきます．\n\n[^2]: jpcityは，e-Statの公開に公開されている「市区町村を探す」と「廃置分合等情報を探す」のデータに基づいて構築されています．\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(\"jpcity\")\n```\n:::\n\n\n### ①市区町村コードや市区町村名の読込み\n\njpcityでは，`parse_city()`関数を用いて市区町村コードから市区町村オブジェクトを構築することができます[^3]． また，`find_city()`関数を用いて市区町村名から市区町村オブジェクトを構築することができます． ただし，`find_city()`は市区町村名が重複する場合にすべての市区町村が返されてしまうため，基本的には`parse_city()`を用いることが推奨されます． さらに，`parse_city()`・`find_city()`は，ともに第2引数`when`に日付を指定することで， その時点での市区町村を取得することができます[^4]．\n\n[^3]: `parse_city()`は，チェックデジット付きの6桁の市区町村コードにも対応しています．\n\n[^4]: `when` 引数を指定しない場合には，いつの期間の市区町村かを推測して読込みを行います．また，期間が整合しない市区町村が含まれる場合には，読込みエラーとなります．\n\nまた，市区町村オブジェクトの市区町村コードや市区町村名への（文字列）変換には，`city_code()`関数や`city_name()`関数を用いることができます．\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(jpcity)\n\ncity <- tibble(city_parsed = parse_city(\"15222\", \"2020-01-01\"),\n               city_found = find_city(\"上越市\", \"2020-01-01\"))\n\ncity\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 2\n  city_parsed          city_found          \n  <city>               <city>              \n1 15222 [新潟県上越市] 15222 [新潟県上越市]\n```\n\n\n:::\n:::\n\n\n### ②市町村合併（廃置分合）処理\n\n`city_convert()`関数を用いて市区町村合併（廃置分合）処理を行うことができます． ここでは，さきほど読み込んだ上越市を例に，2000年1月1日時点での市区町村に変換してみましょう[^5]． `city_convert()`の第2引数`from`は変換前の日付`\"2020-01-01\"`，第3引数`to`は変換後の日付`\"2000-01-01\"`を指定します．\n\n[^5]: 上越市は，1971年4月29日に高田市と直江津市が合併して新設され，その後，2005年1月1日に13町村が上越市に合併されました．\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncity |> \n  select(city_parsed) |> \n  mutate(city_converted = city_parsed |> \n           city_convert(\"2020-01-01\", \"2000-01-01\")) |> \n  unnest(city_converted)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 14 × 2\n   city_parsed          city_converted        \n   <city>               <city>                \n 1 15222 [新潟県上越市] 15521 [新潟県安塚町]  \n 2 15222 [新潟県上越市] 15522 [新潟県浦川原村]\n 3 15222 [新潟県上越市] 15525 [新潟県大島村]  \n 4 15222 [新潟県上越市] 15526 [新潟県牧村]    \n 5 15222 [新潟県上越市] 15541 [新潟県柿崎町]  \n 6 15222 [新潟県上越市] 15542 [新潟県大潟町]  \n 7 15222 [新潟県上越市] 15543 [新潟県頸城村]  \n 8 15222 [新潟県上越市] 15544 [新潟県吉川町]  \n 9 15222 [新潟県上越市] 15546 [新潟県中郷村]  \n10 15222 [新潟県上越市] 15548 [新潟県板倉町]  \n11 15222 [新潟県上越市] 15549 [新潟県清里村]  \n12 15222 [新潟県上越市] 15550 [新潟県三和村]  \n13 15222 [新潟県上越市] 15561 [新潟県名立町]  \n14 15222 [新潟県上越市] 15222 [新潟県上越市]  \n```\n\n\n:::\n:::\n\n\n### ③政令指定都市の市区の対応付け\n\n`city_desig_split()`関数や`city_desig_merge()`関数を用いて政令指定都市の市区の対応付けを行うことができます． ここでは，さきほど事例として挙げた横浜市を対象に，市区の対応付けを行ってみましょう．\n\n`city_desig_split()`関数は，政令指定都市の市を区に分割する関数です．`city_desig_split()`により，横浜市に14の区が存在することがわかります．\n`city_desig_merge()`関数は，政令指定都市の区を市に統合する関数です．`city_desig_merge()`により，さきほど分割した横浜市の区を市に戻すことができます．\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 政令指定都市の市を区に分割\ncity_desig <- tibble(city = parse_city(\"14100\", \"2020-01-01\"),\n                     city_desig = city_desig_split(city)) |> \n  unnest(city_desig)\ncity_desig\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 14 × 2\n   city                   city_desig                      \n   <city>                 <city>                          \n 1 14100 [神奈川県横浜市] 14101 [神奈川県横浜市鶴見区]    \n 2 14100 [神奈川県横浜市] 14102 [神奈川県横浜市神奈川区]  \n 3 14100 [神奈川県横浜市] 14103 [神奈川県横浜市西区]      \n 4 14100 [神奈川県横浜市] 14104 [神奈川県横浜市中区]      \n 5 14100 [神奈川県横浜市] 14105 [神奈川県横浜市南区]      \n 6 14100 [神奈川県横浜市] 14106 [神奈川県横浜市保土ケ谷区]\n 7 14100 [神奈川県横浜市] 14107 [神奈川県横浜市磯子区]    \n 8 14100 [神奈川県横浜市] 14108 [神奈川県横浜市金沢区]    \n 9 14100 [神奈川県横浜市] 14109 [神奈川県横浜市港北区]    \n10 14100 [神奈川県横浜市] 14110 [神奈川県横浜市戸塚区]    \n11 14100 [神奈川県横浜市] 14111 [神奈川県横浜市港南区]    \n12 14100 [神奈川県横浜市] 14112 [神奈川県横浜市旭区]      \n13 14100 [神奈川県横浜市] 14113 [神奈川県横浜市緑区]      \n14 14100 [神奈川県横浜市] 14114 [神奈川県横浜市瀬谷区]    \n```\n\n\n:::\n\n```{.r .cell-code}\n# 政令指定都市の区を市に統合 (最初の数行だけ表示)\ncity_desig |>\n  select(city_desig) |> \n  mutate(city = city_desig_merge(city_desig)) |> \n  head()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 2\n  city_desig                       city                  \n  <city>                           <city>                \n1 14101 [神奈川県横浜市鶴見区]     14100 [神奈川県横浜市]\n2 14102 [神奈川県横浜市神奈川区]   14100 [神奈川県横浜市]\n3 14103 [神奈川県横浜市西区]       14100 [神奈川県横浜市]\n4 14104 [神奈川県横浜市中区]       14100 [神奈川県横浜市]\n5 14105 [神奈川県横浜市南区]       14100 [神奈川県横浜市]\n6 14106 [神奈川県横浜市保土ケ谷区] 14100 [神奈川県横浜市]\n```\n\n\n:::\n:::\n\n\n## まとめ\n\nこの記事では，市区町村データの分析で注意すべき点と，Rのjpcityパッケージを用いて市区町村データをスマートに整形する方法について紹介しました．\njpcityパッケージに対する要望・バグ報告や質問などがあれば，[GitHub](https://github.com/uchidaMizuki/jpcity)か以下のコメント欄からお気軽にご意見をお寄せください．\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}