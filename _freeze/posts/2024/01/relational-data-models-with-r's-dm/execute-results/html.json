{
  "hash": "3b31c461aa1e22a7076bf28232edc8b1",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Rのdmパッケージでデータ前処理の質を高めよう\"\nlang: ja\ncategories: [dm, R, Japanese]\ndate: \"2024-01-28\"\nformat:\n  html:\n    mermaid:\n      theme: default\n    df-print: paged\n---\n\n\n## データ前処理はなぜ重要か？\n\nデータ分析に要する時間のうち，8割は前処理に費やされているといわれています．前処理は，その後のデータ分析の質を左右しますから，前処理の質の向上は非常に重要です．一方で，前処理に膨大な時間を要するということは，作業ミスが起こる確率もそれだけ高くなるということを意味しています．\n\n一般的な（データ構造に対する）前処理には，データフレームの”抽出”・”集約”・”結合”がありますが，なかでも”結合”は，コードが長くなりやすく，作業ミスが起こりやすい作業であると思われます．また，分析で必要となるデータフレームが1つにまとまっていることは稀ですから，データフレームの結合は特に頻出する処理でもあります．\n\nデータフレームの”結合”で起こりがちな典型的なミスとして，以下のようなものがあります[^1]．\n\n[^1]: 幸いなことに，最近のdplyrでは，結合先のデータの”ダブり”に対して警告が出るようになりました．\n\n-   結合するデータフレームがMECE（「漏れなく・ダブりなく」）の状態でない\n-   結合のためのキーを取り違える，または，データ形式が異なる\n\nもしも，これまでデータフレームの結合において，何らかの作業ミスや”ヒヤリ・ハット”を経験したことがあるのであれば，それらを放置せず何らかのパッケージに頼るほうが得策かもしれません．また，仮に作業ミスがなかったとしても，私たちは過去の作業が正しかったかについて疑心暗鬼になりがちです[^2]．\n\n[^2]: その作業を行ったのが過去の自分であっても他の誰かであっても，完全に作業が正しかったという自信は持てないものです．\n\nこの記事では，データフレームの”結合”における作業ミスや疑心暗鬼の解決策として有力なRのdmパッケージを紹介します．\n\n## dmによるリレーショナルデータモデル\n\ndmの提供するリレーショナルデータモデルは，複数のデータ間の関係性を私たちの代わりに管理してくれます．\n\nこの記事では，repurrrsiveパッケージで提供されているStarWarsのデータセットを使って，dmの提供するリレーショナルデータモデルを構築します．あらかじめ，tidyverse，dm，repurrrsiveの3つのパッケージを読み込んでおきましょう．\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(dm)\nlibrary(repurrrsive)\n```\n:::\n\n\nrepurrrsiveで提供されているStarWarsのデータセットには，以下のようなものが含まれています[^3]．\n\n[^3]: repurrrsiveのエクスポートするデータのうち，名前が`sw_`で始まるデータがStarWarsに関するもので，`sw_`以降の部分がデータの内容を表しています．\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"repurrrsiveで提供されているStarWarsのデータセット\"}\ndata(package = \"repurrrsive\") |> \n  chuck(\"results\") |> \n  as_tibble() |> \n  filter(str_starts(Item, \"sw_\")) |> \n  pull(Item)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"sw_films\"     \"sw_people\"    \"sw_planets\"   \"sw_species\"   \"sw_starships\"\n[6] \"sw_vehicles\" \n```\n\n\n:::\n:::\n\n\nここでは，データ分析の題材として，複数のデータ間の関係を扱う必要のある，以下の2つの分析内容を考えてみましょう．正直に言うと，2つの分析の難易度はほぼ同じですが，基礎編では，主にdmのリレーショナルデータモデルの構築する方法を，応用編では，リレーショナルデータモデルの拡張したりキーを検証したりする方法について説明します．\n\n1.  基礎編：StarWars作品の登場人物の故郷の惑星の構成比を調べる\n    -   `sw_films`・`sw_people`・`sw_planets`の3つのデータが必要\n2.  応用編：StarWars作品の登場人物の種族の構成比を調べる\n    -   `sw_films`・`sw_people`・`sw_species`の3つのデータが必要\n\n### 1. 基礎編：StarWars作品の登場人物の故郷の惑星の構成比を調べる\n\n基礎編として，リレーショナルデータモデルを構築して，StarWars作品の登場人物の故郷の惑星の構成比を調べてみましょう．この分析を行うために，以下のように3つのデータフレーム`films`・`people`・`planets`を準備しておきます[^4]．ここでは，分析をシンプルにするため，必要なデータのみを`select`しました[^5]．\n\n[^4]: repurrrsiveのデータはリスト形式で提供されているため，[こちらの記事](https://tidyr.tidyverse.org/articles/rectangle.html)を参考にデータフレームに変換しました．\n\n[^5]: ここでは，sw_peopleのspecies列は不要ですが，次の分析で使用するため選択しておきます．\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfilms <- tibble(film = sw_films) |> \n  unnest_wider(film) |> \n  select(url, title, characters)\npeople <- tibble(person = sw_people) |>\n  unnest_wider(person) |> \n  select(url, name, homeworld, species)\nplanets <- tibble(planet = sw_planets) |>\n  unnest_wider(planet) |> \n  select(url, name)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfilms\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"url\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"title\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"characters\"],\"name\":[3],\"type\":[\"list\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"A New Hope\",\"3\":\"<chr [18]>\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"Attack of the Clones\",\"3\":\"<chr [40]>\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"The Phantom Menace\",\"3\":\"<chr [34]>\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"Revenge of the Sith\",\"3\":\"<chr [34]>\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"Return of the Jedi\",\"3\":\"<chr [20]>\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"The Empire Strikes Back\",\"3\":\"<chr [16]>\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"The Force Awakens\",\"3\":\"<chr [11]>\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\npeople\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"url\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"name\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"homeworld\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"species\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"http://swapi.co/api/people/1/\",\"2\":\"Luke Skywalker\",\"3\":\"http://swapi.co/api/planets/1/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/2/\",\"2\":\"C-3PO\",\"3\":\"http://swapi.co/api/planets/1/\",\"4\":\"http://swapi.co/api/species/2/\"},{\"1\":\"http://swapi.co/api/people/3/\",\"2\":\"R2-D2\",\"3\":\"http://swapi.co/api/planets/8/\",\"4\":\"http://swapi.co/api/species/2/\"},{\"1\":\"http://swapi.co/api/people/4/\",\"2\":\"Darth Vader\",\"3\":\"http://swapi.co/api/planets/1/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/5/\",\"2\":\"Leia Organa\",\"3\":\"http://swapi.co/api/planets/2/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/6/\",\"2\":\"Owen Lars\",\"3\":\"http://swapi.co/api/planets/1/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/7/\",\"2\":\"Beru Whitesun lars\",\"3\":\"http://swapi.co/api/planets/1/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/8/\",\"2\":\"R5-D4\",\"3\":\"http://swapi.co/api/planets/1/\",\"4\":\"http://swapi.co/api/species/2/\"},{\"1\":\"http://swapi.co/api/people/9/\",\"2\":\"Biggs Darklighter\",\"3\":\"http://swapi.co/api/planets/1/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/10/\",\"2\":\"Obi-Wan Kenobi\",\"3\":\"http://swapi.co/api/planets/20/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/11/\",\"2\":\"Anakin Skywalker\",\"3\":\"http://swapi.co/api/planets/1/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/12/\",\"2\":\"Wilhuff Tarkin\",\"3\":\"http://swapi.co/api/planets/21/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/13/\",\"2\":\"Chewbacca\",\"3\":\"http://swapi.co/api/planets/14/\",\"4\":\"http://swapi.co/api/species/3/\"},{\"1\":\"http://swapi.co/api/people/14/\",\"2\":\"Han Solo\",\"3\":\"http://swapi.co/api/planets/22/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/15/\",\"2\":\"Greedo\",\"3\":\"http://swapi.co/api/planets/23/\",\"4\":\"http://swapi.co/api/species/4/\"},{\"1\":\"http://swapi.co/api/people/16/\",\"2\":\"Jabba Desilijic Tiure\",\"3\":\"http://swapi.co/api/planets/24/\",\"4\":\"http://swapi.co/api/species/5/\"},{\"1\":\"http://swapi.co/api/people/18/\",\"2\":\"Wedge Antilles\",\"3\":\"http://swapi.co/api/planets/22/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/19/\",\"2\":\"Jek Tono Porkins\",\"3\":\"http://swapi.co/api/planets/26/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/20/\",\"2\":\"Yoda\",\"3\":\"http://swapi.co/api/planets/28/\",\"4\":\"http://swapi.co/api/species/6/\"},{\"1\":\"http://swapi.co/api/people/21/\",\"2\":\"Palpatine\",\"3\":\"http://swapi.co/api/planets/8/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/22/\",\"2\":\"Boba Fett\",\"3\":\"http://swapi.co/api/planets/10/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/23/\",\"2\":\"IG-88\",\"3\":\"http://swapi.co/api/planets/28/\",\"4\":\"http://swapi.co/api/species/2/\"},{\"1\":\"http://swapi.co/api/people/24/\",\"2\":\"Bossk\",\"3\":\"http://swapi.co/api/planets/29/\",\"4\":\"http://swapi.co/api/species/7/\"},{\"1\":\"http://swapi.co/api/people/25/\",\"2\":\"Lando Calrissian\",\"3\":\"http://swapi.co/api/planets/30/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/26/\",\"2\":\"Lobot\",\"3\":\"http://swapi.co/api/planets/6/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/27/\",\"2\":\"Ackbar\",\"3\":\"http://swapi.co/api/planets/31/\",\"4\":\"http://swapi.co/api/species/8/\"},{\"1\":\"http://swapi.co/api/people/28/\",\"2\":\"Mon Mothma\",\"3\":\"http://swapi.co/api/planets/32/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/29/\",\"2\":\"Arvel Crynyd\",\"3\":\"http://swapi.co/api/planets/28/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/30/\",\"2\":\"Wicket Systri Warrick\",\"3\":\"http://swapi.co/api/planets/7/\",\"4\":\"http://swapi.co/api/species/9/\"},{\"1\":\"http://swapi.co/api/people/31/\",\"2\":\"Nien Nunb\",\"3\":\"http://swapi.co/api/planets/33/\",\"4\":\"http://swapi.co/api/species/10/\"},{\"1\":\"http://swapi.co/api/people/32/\",\"2\":\"Qui-Gon Jinn\",\"3\":\"http://swapi.co/api/planets/28/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/33/\",\"2\":\"Nute Gunray\",\"3\":\"http://swapi.co/api/planets/18/\",\"4\":\"http://swapi.co/api/species/11/\"},{\"1\":\"http://swapi.co/api/people/34/\",\"2\":\"Finis Valorum\",\"3\":\"http://swapi.co/api/planets/9/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/36/\",\"2\":\"Jar Jar Binks\",\"3\":\"http://swapi.co/api/planets/8/\",\"4\":\"http://swapi.co/api/species/12/\"},{\"1\":\"http://swapi.co/api/people/37/\",\"2\":\"Roos Tarpals\",\"3\":\"http://swapi.co/api/planets/8/\",\"4\":\"http://swapi.co/api/species/12/\"},{\"1\":\"http://swapi.co/api/people/38/\",\"2\":\"Rugor Nass\",\"3\":\"http://swapi.co/api/planets/8/\",\"4\":\"http://swapi.co/api/species/12/\"},{\"1\":\"http://swapi.co/api/people/39/\",\"2\":\"Ric Olié\",\"3\":\"http://swapi.co/api/planets/8/\",\"4\":\"NA\"},{\"1\":\"http://swapi.co/api/people/40/\",\"2\":\"Watto\",\"3\":\"http://swapi.co/api/planets/34/\",\"4\":\"http://swapi.co/api/species/13/\"},{\"1\":\"http://swapi.co/api/people/41/\",\"2\":\"Sebulba\",\"3\":\"http://swapi.co/api/planets/35/\",\"4\":\"http://swapi.co/api/species/14/\"},{\"1\":\"http://swapi.co/api/people/42/\",\"2\":\"Quarsh Panaka\",\"3\":\"http://swapi.co/api/planets/8/\",\"4\":\"NA\"},{\"1\":\"http://swapi.co/api/people/43/\",\"2\":\"Shmi Skywalker\",\"3\":\"http://swapi.co/api/planets/1/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/44/\",\"2\":\"Darth Maul\",\"3\":\"http://swapi.co/api/planets/36/\",\"4\":\"http://swapi.co/api/species/22/\"},{\"1\":\"http://swapi.co/api/people/45/\",\"2\":\"Bib Fortuna\",\"3\":\"http://swapi.co/api/planets/37/\",\"4\":\"http://swapi.co/api/species/15/\"},{\"1\":\"http://swapi.co/api/people/46/\",\"2\":\"Ayla Secura\",\"3\":\"http://swapi.co/api/planets/37/\",\"4\":\"http://swapi.co/api/species/15/\"},{\"1\":\"http://swapi.co/api/people/48/\",\"2\":\"Dud Bolt\",\"3\":\"http://swapi.co/api/planets/39/\",\"4\":\"http://swapi.co/api/species/17/\"},{\"1\":\"http://swapi.co/api/people/49/\",\"2\":\"Gasgano\",\"3\":\"http://swapi.co/api/planets/40/\",\"4\":\"http://swapi.co/api/species/18/\"},{\"1\":\"http://swapi.co/api/people/50/\",\"2\":\"Ben Quadinaros\",\"3\":\"http://swapi.co/api/planets/41/\",\"4\":\"http://swapi.co/api/species/19/\"},{\"1\":\"http://swapi.co/api/people/51/\",\"2\":\"Mace Windu\",\"3\":\"http://swapi.co/api/planets/42/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/52/\",\"2\":\"Ki-Adi-Mundi\",\"3\":\"http://swapi.co/api/planets/43/\",\"4\":\"http://swapi.co/api/species/20/\"},{\"1\":\"http://swapi.co/api/people/53/\",\"2\":\"Kit Fisto\",\"3\":\"http://swapi.co/api/planets/44/\",\"4\":\"http://swapi.co/api/species/21/\"},{\"1\":\"http://swapi.co/api/people/54/\",\"2\":\"Eeth Koth\",\"3\":\"http://swapi.co/api/planets/45/\",\"4\":\"http://swapi.co/api/species/22/\"},{\"1\":\"http://swapi.co/api/people/55/\",\"2\":\"Adi Gallia\",\"3\":\"http://swapi.co/api/planets/9/\",\"4\":\"http://swapi.co/api/species/23/\"},{\"1\":\"http://swapi.co/api/people/56/\",\"2\":\"Saesee Tiin\",\"3\":\"http://swapi.co/api/planets/47/\",\"4\":\"http://swapi.co/api/species/24/\"},{\"1\":\"http://swapi.co/api/people/57/\",\"2\":\"Yarael Poof\",\"3\":\"http://swapi.co/api/planets/48/\",\"4\":\"http://swapi.co/api/species/25/\"},{\"1\":\"http://swapi.co/api/people/58/\",\"2\":\"Plo Koon\",\"3\":\"http://swapi.co/api/planets/49/\",\"4\":\"http://swapi.co/api/species/26/\"},{\"1\":\"http://swapi.co/api/people/59/\",\"2\":\"Mas Amedda\",\"3\":\"http://swapi.co/api/planets/50/\",\"4\":\"http://swapi.co/api/species/27/\"},{\"1\":\"http://swapi.co/api/people/60/\",\"2\":\"Gregar Typho\",\"3\":\"http://swapi.co/api/planets/8/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/61/\",\"2\":\"Cordé\",\"3\":\"http://swapi.co/api/planets/8/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/62/\",\"2\":\"Cliegg Lars\",\"3\":\"http://swapi.co/api/planets/1/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/63/\",\"2\":\"Poggle the Lesser\",\"3\":\"http://swapi.co/api/planets/11/\",\"4\":\"http://swapi.co/api/species/28/\"},{\"1\":\"http://swapi.co/api/people/64/\",\"2\":\"Luminara Unduli\",\"3\":\"http://swapi.co/api/planets/51/\",\"4\":\"http://swapi.co/api/species/29/\"},{\"1\":\"http://swapi.co/api/people/65/\",\"2\":\"Barriss Offee\",\"3\":\"http://swapi.co/api/planets/51/\",\"4\":\"http://swapi.co/api/species/29/\"},{\"1\":\"http://swapi.co/api/people/66/\",\"2\":\"Dormé\",\"3\":\"http://swapi.co/api/planets/8/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/67/\",\"2\":\"Dooku\",\"3\":\"http://swapi.co/api/planets/52/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/68/\",\"2\":\"Bail Prestor Organa\",\"3\":\"http://swapi.co/api/planets/2/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/69/\",\"2\":\"Jango Fett\",\"3\":\"http://swapi.co/api/planets/53/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/70/\",\"2\":\"Zam Wesell\",\"3\":\"http://swapi.co/api/planets/54/\",\"4\":\"http://swapi.co/api/species/30/\"},{\"1\":\"http://swapi.co/api/people/71/\",\"2\":\"Dexter Jettster\",\"3\":\"http://swapi.co/api/planets/55/\",\"4\":\"http://swapi.co/api/species/31/\"},{\"1\":\"http://swapi.co/api/people/72/\",\"2\":\"Lama Su\",\"3\":\"http://swapi.co/api/planets/10/\",\"4\":\"http://swapi.co/api/species/32/\"},{\"1\":\"http://swapi.co/api/people/73/\",\"2\":\"Taun We\",\"3\":\"http://swapi.co/api/planets/10/\",\"4\":\"http://swapi.co/api/species/32/\"},{\"1\":\"http://swapi.co/api/people/74/\",\"2\":\"Jocasta Nu\",\"3\":\"http://swapi.co/api/planets/9/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/47/\",\"2\":\"Ratts Tyerell\",\"3\":\"http://swapi.co/api/planets/38/\",\"4\":\"http://swapi.co/api/species/16/\"},{\"1\":\"http://swapi.co/api/people/75/\",\"2\":\"R4-P17\",\"3\":\"http://swapi.co/api/planets/28/\",\"4\":\"NA\"},{\"1\":\"http://swapi.co/api/people/76/\",\"2\":\"Wat Tambor\",\"3\":\"http://swapi.co/api/planets/56/\",\"4\":\"http://swapi.co/api/species/33/\"},{\"1\":\"http://swapi.co/api/people/77/\",\"2\":\"San Hill\",\"3\":\"http://swapi.co/api/planets/57/\",\"4\":\"http://swapi.co/api/species/34/\"},{\"1\":\"http://swapi.co/api/people/78/\",\"2\":\"Shaak Ti\",\"3\":\"http://swapi.co/api/planets/58/\",\"4\":\"http://swapi.co/api/species/35/\"},{\"1\":\"http://swapi.co/api/people/79/\",\"2\":\"Grievous\",\"3\":\"http://swapi.co/api/planets/59/\",\"4\":\"http://swapi.co/api/species/36/\"},{\"1\":\"http://swapi.co/api/people/80/\",\"2\":\"Tarfful\",\"3\":\"http://swapi.co/api/planets/14/\",\"4\":\"http://swapi.co/api/species/3/\"},{\"1\":\"http://swapi.co/api/people/81/\",\"2\":\"Raymus Antilles\",\"3\":\"http://swapi.co/api/planets/2/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/82/\",\"2\":\"Sly Moore\",\"3\":\"http://swapi.co/api/planets/60/\",\"4\":\"NA\"},{\"1\":\"http://swapi.co/api/people/83/\",\"2\":\"Tion Medon\",\"3\":\"http://swapi.co/api/planets/12/\",\"4\":\"http://swapi.co/api/species/37/\"},{\"1\":\"http://swapi.co/api/people/84/\",\"2\":\"Finn\",\"3\":\"http://swapi.co/api/planets/28/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/85/\",\"2\":\"Rey\",\"3\":\"http://swapi.co/api/planets/28/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/86/\",\"2\":\"Poe Dameron\",\"3\":\"http://swapi.co/api/planets/28/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/87/\",\"2\":\"BB8\",\"3\":\"http://swapi.co/api/planets/28/\",\"4\":\"http://swapi.co/api/species/2/\"},{\"1\":\"http://swapi.co/api/people/88/\",\"2\":\"Captain Phasma\",\"3\":\"http://swapi.co/api/planets/28/\",\"4\":\"NA\"},{\"1\":\"http://swapi.co/api/people/35/\",\"2\":\"Padmé Amidala\",\"3\":\"http://swapi.co/api/planets/8/\",\"4\":\"http://swapi.co/api/species/1/\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\nplanets\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"url\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"name\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"http://swapi.co/api/planets/2/\",\"2\":\"Alderaan\"},{\"1\":\"http://swapi.co/api/planets/3/\",\"2\":\"Yavin IV\"},{\"1\":\"http://swapi.co/api/planets/4/\",\"2\":\"Hoth\"},{\"1\":\"http://swapi.co/api/planets/5/\",\"2\":\"Dagobah\"},{\"1\":\"http://swapi.co/api/planets/6/\",\"2\":\"Bespin\"},{\"1\":\"http://swapi.co/api/planets/7/\",\"2\":\"Endor\"},{\"1\":\"http://swapi.co/api/planets/8/\",\"2\":\"Naboo\"},{\"1\":\"http://swapi.co/api/planets/9/\",\"2\":\"Coruscant\"},{\"1\":\"http://swapi.co/api/planets/10/\",\"2\":\"Kamino\"},{\"1\":\"http://swapi.co/api/planets/11/\",\"2\":\"Geonosis\"},{\"1\":\"http://swapi.co/api/planets/12/\",\"2\":\"Utapau\"},{\"1\":\"http://swapi.co/api/planets/13/\",\"2\":\"Mustafar\"},{\"1\":\"http://swapi.co/api/planets/14/\",\"2\":\"Kashyyyk\"},{\"1\":\"http://swapi.co/api/planets/15/\",\"2\":\"Polis Massa\"},{\"1\":\"http://swapi.co/api/planets/16/\",\"2\":\"Mygeeto\"},{\"1\":\"http://swapi.co/api/planets/17/\",\"2\":\"Felucia\"},{\"1\":\"http://swapi.co/api/planets/18/\",\"2\":\"Cato Neimoidia\"},{\"1\":\"http://swapi.co/api/planets/19/\",\"2\":\"Saleucami\"},{\"1\":\"http://swapi.co/api/planets/20/\",\"2\":\"Stewjon\"},{\"1\":\"http://swapi.co/api/planets/21/\",\"2\":\"Eriadu\"},{\"1\":\"http://swapi.co/api/planets/22/\",\"2\":\"Corellia\"},{\"1\":\"http://swapi.co/api/planets/23/\",\"2\":\"Rodia\"},{\"1\":\"http://swapi.co/api/planets/24/\",\"2\":\"Nal Hutta\"},{\"1\":\"http://swapi.co/api/planets/25/\",\"2\":\"Dantooine\"},{\"1\":\"http://swapi.co/api/planets/26/\",\"2\":\"Bestine IV\"},{\"1\":\"http://swapi.co/api/planets/27/\",\"2\":\"Ord Mantell\"},{\"1\":\"http://swapi.co/api/planets/28/\",\"2\":\"unknown\"},{\"1\":\"http://swapi.co/api/planets/29/\",\"2\":\"Trandosha\"},{\"1\":\"http://swapi.co/api/planets/30/\",\"2\":\"Socorro\"},{\"1\":\"http://swapi.co/api/planets/31/\",\"2\":\"Mon Cala\"},{\"1\":\"http://swapi.co/api/planets/32/\",\"2\":\"Chandrila\"},{\"1\":\"http://swapi.co/api/planets/33/\",\"2\":\"Sullust\"},{\"1\":\"http://swapi.co/api/planets/34/\",\"2\":\"Toydaria\"},{\"1\":\"http://swapi.co/api/planets/35/\",\"2\":\"Malastare\"},{\"1\":\"http://swapi.co/api/planets/36/\",\"2\":\"Dathomir\"},{\"1\":\"http://swapi.co/api/planets/37/\",\"2\":\"Ryloth\"},{\"1\":\"http://swapi.co/api/planets/38/\",\"2\":\"Aleen Minor\"},{\"1\":\"http://swapi.co/api/planets/39/\",\"2\":\"Vulpter\"},{\"1\":\"http://swapi.co/api/planets/40/\",\"2\":\"Troiken\"},{\"1\":\"http://swapi.co/api/planets/41/\",\"2\":\"Tund\"},{\"1\":\"http://swapi.co/api/planets/42/\",\"2\":\"Haruun Kal\"},{\"1\":\"http://swapi.co/api/planets/43/\",\"2\":\"Cerea\"},{\"1\":\"http://swapi.co/api/planets/44/\",\"2\":\"Glee Anselm\"},{\"1\":\"http://swapi.co/api/planets/45/\",\"2\":\"Iridonia\"},{\"1\":\"http://swapi.co/api/planets/46/\",\"2\":\"Tholoth\"},{\"1\":\"http://swapi.co/api/planets/47/\",\"2\":\"Iktotch\"},{\"1\":\"http://swapi.co/api/planets/48/\",\"2\":\"Quermia\"},{\"1\":\"http://swapi.co/api/planets/49/\",\"2\":\"Dorin\"},{\"1\":\"http://swapi.co/api/planets/50/\",\"2\":\"Champala\"},{\"1\":\"http://swapi.co/api/planets/51/\",\"2\":\"Mirial\"},{\"1\":\"http://swapi.co/api/planets/52/\",\"2\":\"Serenno\"},{\"1\":\"http://swapi.co/api/planets/53/\",\"2\":\"Concord Dawn\"},{\"1\":\"http://swapi.co/api/planets/54/\",\"2\":\"Zolan\"},{\"1\":\"http://swapi.co/api/planets/55/\",\"2\":\"Ojom\"},{\"1\":\"http://swapi.co/api/planets/56/\",\"2\":\"Skako\"},{\"1\":\"http://swapi.co/api/planets/57/\",\"2\":\"Muunilinst\"},{\"1\":\"http://swapi.co/api/planets/58/\",\"2\":\"Shili\"},{\"1\":\"http://swapi.co/api/planets/59/\",\"2\":\"Kalee\"},{\"1\":\"http://swapi.co/api/planets/60/\",\"2\":\"Umbara\"},{\"1\":\"http://swapi.co/api/planets/1/\",\"2\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/planets/61/\",\"2\":\"Jakku\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n準備したデータフレームを確認すると，各データフレームの`url`列がキーとして用いられていることがわかりますので，データフレーム間の関係は以下のようにまとめることができます[^6]．特に，1つの映画作品には複数の登場人物が登場することが一般的ですので，`films`の`characters`列が登場人物のリストになっていることに注意が必要です．そのため，このままでは，`films`の`characters`列を`people`の`url`列と対応付けることができません．\n\n[^6]: ここでは，データフレーム間の関係を図示するために，mermaidを使用しました．\n\n\n```{mermaid}\nflowchart TB\n  films.characters --> people.url\n  people.homeworld --> planets.url\n  subgraph films\n    films.url[url]\n    films.title[title]\n    films.characters[List of characters] \n  end\n  subgraph people\n    people.url[url]\n    people.name[name]\n    people.homeworld[homeworld]\n  end\n  subgraph planets\n    planets.url[url]\n    planets.name[name]\n  end\n```\n\n\nそこで，`films`と`people`の関係，すなわち，どの作品にどの登場人物が登場するかを表すデータ`films_x_characters`を新たに作成することを考えます[^7]．`films_x_characters`を介すことで，データ間の関係を以下のようにまとめることができます．\n\n[^7]: 作品と登場人物には，明確な上下関係はありませんので，`characters_x_films`という名称でも構いません．\n\n\n```{mermaid}\nflowchart TB\n  films_x_characters.url --> films.url\n  films_x_characters.characters ---> people.url\n  people.homeworld --> planets.url\n  subgraph films_x_characters\n    films_x_characters.url[url]\n    films_x_characters.characters[characters]\n  end\n  subgraph films\n    films.url[url]\n    films.title[title]\n  end\n  subgraph people\n    people.url[url]\n    people.name[name]\n    people.homeworld[homeworld]\n  end\n  subgraph planets\n    planets.url[url]\n    planets.name[name]\n  end\n```\n\n\nそれでは，上のイメージに従って，実際にリレーショナルデータモデルを構築してみましょう．まず，`films`の`url`・`characters`列を使って`films_x_characters`を作成します．ついでに`films`から不要となった`characters`列を削除しておきます．\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create films_x_characters and remove characters column from films\nfilms_x_characters <- films |> \n  select(url, characters) |> \n  unnest_longer(characters)\nfilms <- films |> \n  select(!characters)\n\nfilms_x_characters\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"url\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"characters\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/1/\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/2/\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/3/\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/4/\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/5/\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/6/\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/7/\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/8/\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/9/\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/10/\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/12/\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/13/\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/14/\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/15/\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/16/\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/18/\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/19/\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/81/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/2/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/3/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/6/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/7/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/10/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/11/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/20/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/21/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/22/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/33/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/36/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/40/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/43/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/46/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/51/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/52/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/53/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/58/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/59/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/60/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/61/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/62/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/63/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/64/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/65/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/66/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/67/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/68/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/69/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/70/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/71/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/72/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/73/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/74/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/75/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/76/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/77/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/78/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/82/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/35/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/2/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/3/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/10/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/11/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/16/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/20/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/21/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/32/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/33/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/34/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/36/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/37/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/38/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/39/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/40/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/41/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/42/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/43/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/44/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/46/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/48/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/49/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/50/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/51/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/52/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/53/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/54/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/55/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/56/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/57/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/58/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/59/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/47/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/35/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/1/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/2/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/3/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/4/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/5/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/6/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/7/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/10/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/11/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/12/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/13/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/20/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/21/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/33/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/46/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/51/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/52/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/53/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/54/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/55/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/56/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/58/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/63/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/64/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/67/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/68/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/75/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/78/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/79/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/80/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/81/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/82/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/83/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/35/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/1/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/2/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/3/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/4/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/5/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/10/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/13/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/14/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/16/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/18/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/20/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/21/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/22/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/25/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/27/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/28/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/29/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/30/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/31/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/45/\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/1/\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/2/\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/3/\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/4/\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/5/\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/10/\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/13/\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/14/\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/18/\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/20/\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/21/\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/22/\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/23/\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/24/\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/25/\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/26/\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/1/\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/3/\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/5/\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/13/\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/14/\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/27/\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/84/\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/85/\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/86/\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/87/\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/88/\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n最後に，`dm()`に準備した`films`・`people`・`planets`・`films_x_characters`を渡した後，主キー（primary keys）と外部キー（foreign keys）を追加することで，リレーショナルデータモデルを構築することができます．\n\ndmでは，主キーを`dm_add_pk()`で[^8]，外部キーを`dm_add_fk()`で設定します[^9]．\n\n[^8]: `films`・`people`・`planets`については，`url`列が主キーとなり，`films_x_characters`については，`url`・`characters`列の2列の組合せが主キーとなります．\n\n[^9]: 上のイメージの矢印に従って，`films_x_characters`の`url`・`characters`列を，それぞれ`films`・`people`の`url`列に対応付けます．さらに，`people`の`homeworld`列を`planets`の`url`列に対応付けます．\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndm_starwars_1 <- dm(films, people, planets, films_x_characters) |> \n  \n  # 1. Add primary keys\n  dm_add_pk(films, url) |>\n  dm_add_pk(people, url) |>\n  dm_add_pk(planets, url) |>\n  dm_add_pk(films_x_characters, c(url, characters)) |>\n  \n  # 2. Add foreign keys\n  dm_add_fk(films_x_characters, url, films) |> \n  dm_add_fk(films_x_characters, characters, people) |>\n  dm_add_fk(people, homeworld, planets) \n\ndm_starwars_1\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n── Metadata ────────────────────────────────────────────────────────────────────\nTables: `films`, `people`, `planets`, `films_x_characters`\nColumns: 10\nPrimary keys: 4\nForeign keys: 3\n```\n\n\n:::\n:::\n\n\n`dm_draw()`を用いて，リレーショナルデータモデルを描画することもできます．描画してみると，上のイメージと同様の関係が構築されていることがわかります．\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndm_draw(dm_starwars_1)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"grViz html-widget html-fill-item\" id=\"htmlwidget-7d213081b18ae09160c2\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-7d213081b18ae09160c2\">{\"x\":{\"diagram\":\"#data_model\\ndigraph {\\ngraph [rankdir=LR tooltip=\\\"Data Model\\\" ]\\n\\nnode [margin=0 fontcolor = \\\"#444444\\\" ]\\n\\nedge [color = \\\"#555555\\\", arrowsize = 1, ]\\n\\npack=true\\npackmode= \\\"node\\\"\\n\\n  \\\"films\\\" [id = \\\"films\\\", label = <<TABLE ALIGN=\\\"LEFT\\\" BORDER=\\\"1\\\" CELLBORDER=\\\"0\\\" CELLSPACING=\\\"0\\\" COLOR=\\\"#555555\\\">\\n    <TR>\\n      <TD COLSPAN=\\\"1\\\" BGCOLOR=\\\"#EFEBDD\\\" BORDER=\\\"0\\\"><FONT COLOR=\\\"#000000\\\">films<\\/FONT>\\n<\\/TD>\\n    <\\/TR>\\n    <TR>\\n      <TD ALIGN=\\\"LEFT\\\" BGCOLOR=\\\"#FFFFFF\\\" PORT=\\\"url\\\"><U>url<\\/U><\\/TD>\\n    <\\/TR>\\n  <\\/TABLE>>, shape = \\\"plaintext\\\"] \\n\\n  \\\"films_x_characters\\\" [id = \\\"films_x_characters\\\", label = <<TABLE ALIGN=\\\"LEFT\\\" BORDER=\\\"1\\\" CELLBORDER=\\\"0\\\" CELLSPACING=\\\"0\\\" COLOR=\\\"#555555\\\">\\n    <TR>\\n      <TD COLSPAN=\\\"1\\\" BGCOLOR=\\\"#EFEBDD\\\" BORDER=\\\"0\\\"><FONT COLOR=\\\"#000000\\\">films_x_characters<\\/FONT>\\n<\\/TD>\\n    <\\/TR>\\n    <TR>\\n      <TD ALIGN=\\\"LEFT\\\" BGCOLOR=\\\"#FFFFFF\\\" PORT=\\\"url\\\">url<\\/TD>\\n    <\\/TR>\\n    <TR>\\n      <TD ALIGN=\\\"LEFT\\\" BGCOLOR=\\\"#FFFFFF\\\" PORT=\\\"characters\\\">characters<\\/TD>\\n    <\\/TR>\\n    <TR>\\n      <TD ALIGN=\\\"LEFT\\\" BGCOLOR=\\\"#FFFFFF\\\" PORT=\\\"url, characters\\\"><U>url, characters<\\/U><\\/TD>\\n    <\\/TR>\\n  <\\/TABLE>>, shape = \\\"plaintext\\\"] \\n\\n  \\\"people\\\" [id = \\\"people\\\", label = <<TABLE ALIGN=\\\"LEFT\\\" BORDER=\\\"1\\\" CELLBORDER=\\\"0\\\" CELLSPACING=\\\"0\\\" COLOR=\\\"#555555\\\">\\n    <TR>\\n      <TD COLSPAN=\\\"1\\\" BGCOLOR=\\\"#EFEBDD\\\" BORDER=\\\"0\\\"><FONT COLOR=\\\"#000000\\\">people<\\/FONT>\\n<\\/TD>\\n    <\\/TR>\\n    <TR>\\n      <TD ALIGN=\\\"LEFT\\\" BGCOLOR=\\\"#FFFFFF\\\" PORT=\\\"url\\\"><U>url<\\/U><\\/TD>\\n    <\\/TR>\\n    <TR>\\n      <TD ALIGN=\\\"LEFT\\\" BGCOLOR=\\\"#FFFFFF\\\" PORT=\\\"homeworld\\\">homeworld<\\/TD>\\n    <\\/TR>\\n  <\\/TABLE>>, shape = \\\"plaintext\\\"] \\n\\n  \\\"planets\\\" [id = \\\"planets\\\", label = <<TABLE ALIGN=\\\"LEFT\\\" BORDER=\\\"1\\\" CELLBORDER=\\\"0\\\" CELLSPACING=\\\"0\\\" COLOR=\\\"#555555\\\">\\n    <TR>\\n      <TD COLSPAN=\\\"1\\\" BGCOLOR=\\\"#EFEBDD\\\" BORDER=\\\"0\\\"><FONT COLOR=\\\"#000000\\\">planets<\\/FONT>\\n<\\/TD>\\n    <\\/TR>\\n    <TR>\\n      <TD ALIGN=\\\"LEFT\\\" BGCOLOR=\\\"#FFFFFF\\\" PORT=\\\"url\\\"><U>url<\\/U><\\/TD>\\n    <\\/TR>\\n  <\\/TABLE>>, shape = \\\"plaintext\\\"] \\n\\n\\\"films_x_characters\\\":\\\"url\\\"->\\\"films\\\":\\\"url\\\" [id=\\\"films_x_characters_1\\\"]\\n\\\"films_x_characters\\\":\\\"characters\\\"->\\\"people\\\":\\\"url\\\" [id=\\\"films_x_characters_2\\\"]\\n\\\"people\\\":\\\"homeworld\\\"->\\\"planets\\\":\\\"url\\\" [id=\\\"people_1\\\"]\\n}\",\"config\":{\"engine\":null,\"options\":null}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n以下のように`dm_flatten_to_tbl()`を用いることで，`films_x_characters`データに`films`・`people`・`planets`データを結合したデータフレームを作成することができます[^10]．この際，異なるデータ間で同名の列名が存在する場合には，データ名に応じて自動的に列名が変更されます．このように，リレーショナルデータモデルが私たちの代わりにデータ間の関係を管理してくれるおかげで，他のデータ間との関係に基づいて自動的にデータフレームを結合することができます．\n\n[^10]: dmでは，各データを”テーブル”と呼びます．\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_films_x_characters_1 <- dm_starwars_1 |> \n  dm_flatten_to_tbl(films_x_characters,\n                    .recursive = TRUE) \n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRenaming ambiguous columns: %>%\n  dm_rename(people, name.people = name) %>%\n  dm_rename(planets, name.planets = name)\n```\n\n\n:::\n\n```{.r .cell-code}\ndata_films_x_characters_1\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"url\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"characters\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"title\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"name.people\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"homeworld\"],\"name\":[5],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"species\"],\"name\":[6],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"name.planets\"],\"name\":[7],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/1/\",\"3\":\"A New Hope\",\"4\":\"Luke Skywalker\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/2/\",\"3\":\"A New Hope\",\"4\":\"C-3PO\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/2/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/3/\",\"3\":\"A New Hope\",\"4\":\"R2-D2\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/2/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/4/\",\"3\":\"A New Hope\",\"4\":\"Darth Vader\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/5/\",\"3\":\"A New Hope\",\"4\":\"Leia Organa\",\"5\":\"http://swapi.co/api/planets/2/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Alderaan\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/6/\",\"3\":\"A New Hope\",\"4\":\"Owen Lars\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/7/\",\"3\":\"A New Hope\",\"4\":\"Beru Whitesun lars\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/8/\",\"3\":\"A New Hope\",\"4\":\"R5-D4\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/2/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/9/\",\"3\":\"A New Hope\",\"4\":\"Biggs Darklighter\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/10/\",\"3\":\"A New Hope\",\"4\":\"Obi-Wan Kenobi\",\"5\":\"http://swapi.co/api/planets/20/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Stewjon\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/12/\",\"3\":\"A New Hope\",\"4\":\"Wilhuff Tarkin\",\"5\":\"http://swapi.co/api/planets/21/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Eriadu\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/13/\",\"3\":\"A New Hope\",\"4\":\"Chewbacca\",\"5\":\"http://swapi.co/api/planets/14/\",\"6\":\"http://swapi.co/api/species/3/\",\"7\":\"Kashyyyk\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/14/\",\"3\":\"A New Hope\",\"4\":\"Han Solo\",\"5\":\"http://swapi.co/api/planets/22/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Corellia\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/15/\",\"3\":\"A New Hope\",\"4\":\"Greedo\",\"5\":\"http://swapi.co/api/planets/23/\",\"6\":\"http://swapi.co/api/species/4/\",\"7\":\"Rodia\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/16/\",\"3\":\"A New Hope\",\"4\":\"Jabba Desilijic Tiure\",\"5\":\"http://swapi.co/api/planets/24/\",\"6\":\"http://swapi.co/api/species/5/\",\"7\":\"Nal Hutta\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/18/\",\"3\":\"A New Hope\",\"4\":\"Wedge Antilles\",\"5\":\"http://swapi.co/api/planets/22/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Corellia\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/19/\",\"3\":\"A New Hope\",\"4\":\"Jek Tono Porkins\",\"5\":\"http://swapi.co/api/planets/26/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Bestine IV\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/81/\",\"3\":\"A New Hope\",\"4\":\"Raymus Antilles\",\"5\":\"http://swapi.co/api/planets/2/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Alderaan\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/2/\",\"3\":\"Attack of the Clones\",\"4\":\"C-3PO\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/2/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/3/\",\"3\":\"Attack of the Clones\",\"4\":\"R2-D2\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/2/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/6/\",\"3\":\"Attack of the Clones\",\"4\":\"Owen Lars\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/7/\",\"3\":\"Attack of the Clones\",\"4\":\"Beru Whitesun lars\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/10/\",\"3\":\"Attack of the Clones\",\"4\":\"Obi-Wan Kenobi\",\"5\":\"http://swapi.co/api/planets/20/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Stewjon\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/11/\",\"3\":\"Attack of the Clones\",\"4\":\"Anakin Skywalker\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/20/\",\"3\":\"Attack of the Clones\",\"4\":\"Yoda\",\"5\":\"http://swapi.co/api/planets/28/\",\"6\":\"http://swapi.co/api/species/6/\",\"7\":\"unknown\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/21/\",\"3\":\"Attack of the Clones\",\"4\":\"Palpatine\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/22/\",\"3\":\"Attack of the Clones\",\"4\":\"Boba Fett\",\"5\":\"http://swapi.co/api/planets/10/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Kamino\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/33/\",\"3\":\"Attack of the Clones\",\"4\":\"Nute Gunray\",\"5\":\"http://swapi.co/api/planets/18/\",\"6\":\"http://swapi.co/api/species/11/\",\"7\":\"Cato Neimoidia\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/36/\",\"3\":\"Attack of the Clones\",\"4\":\"Jar Jar Binks\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/12/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/40/\",\"3\":\"Attack of the Clones\",\"4\":\"Watto\",\"5\":\"http://swapi.co/api/planets/34/\",\"6\":\"http://swapi.co/api/species/13/\",\"7\":\"Toydaria\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/43/\",\"3\":\"Attack of the Clones\",\"4\":\"Shmi Skywalker\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/46/\",\"3\":\"Attack of the Clones\",\"4\":\"Ayla Secura\",\"5\":\"http://swapi.co/api/planets/37/\",\"6\":\"http://swapi.co/api/species/15/\",\"7\":\"Ryloth\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/51/\",\"3\":\"Attack of the Clones\",\"4\":\"Mace Windu\",\"5\":\"http://swapi.co/api/planets/42/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Haruun Kal\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/52/\",\"3\":\"Attack of the Clones\",\"4\":\"Ki-Adi-Mundi\",\"5\":\"http://swapi.co/api/planets/43/\",\"6\":\"http://swapi.co/api/species/20/\",\"7\":\"Cerea\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/53/\",\"3\":\"Attack of the Clones\",\"4\":\"Kit Fisto\",\"5\":\"http://swapi.co/api/planets/44/\",\"6\":\"http://swapi.co/api/species/21/\",\"7\":\"Glee Anselm\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/58/\",\"3\":\"Attack of the Clones\",\"4\":\"Plo Koon\",\"5\":\"http://swapi.co/api/planets/49/\",\"6\":\"http://swapi.co/api/species/26/\",\"7\":\"Dorin\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/59/\",\"3\":\"Attack of the Clones\",\"4\":\"Mas Amedda\",\"5\":\"http://swapi.co/api/planets/50/\",\"6\":\"http://swapi.co/api/species/27/\",\"7\":\"Champala\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/60/\",\"3\":\"Attack of the Clones\",\"4\":\"Gregar Typho\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/61/\",\"3\":\"Attack of the Clones\",\"4\":\"Cordé\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/62/\",\"3\":\"Attack of the Clones\",\"4\":\"Cliegg Lars\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/63/\",\"3\":\"Attack of the Clones\",\"4\":\"Poggle the Lesser\",\"5\":\"http://swapi.co/api/planets/11/\",\"6\":\"http://swapi.co/api/species/28/\",\"7\":\"Geonosis\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/64/\",\"3\":\"Attack of the Clones\",\"4\":\"Luminara Unduli\",\"5\":\"http://swapi.co/api/planets/51/\",\"6\":\"http://swapi.co/api/species/29/\",\"7\":\"Mirial\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/65/\",\"3\":\"Attack of the Clones\",\"4\":\"Barriss Offee\",\"5\":\"http://swapi.co/api/planets/51/\",\"6\":\"http://swapi.co/api/species/29/\",\"7\":\"Mirial\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/66/\",\"3\":\"Attack of the Clones\",\"4\":\"Dormé\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/67/\",\"3\":\"Attack of the Clones\",\"4\":\"Dooku\",\"5\":\"http://swapi.co/api/planets/52/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Serenno\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/68/\",\"3\":\"Attack of the Clones\",\"4\":\"Bail Prestor Organa\",\"5\":\"http://swapi.co/api/planets/2/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Alderaan\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/69/\",\"3\":\"Attack of the Clones\",\"4\":\"Jango Fett\",\"5\":\"http://swapi.co/api/planets/53/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Concord Dawn\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/70/\",\"3\":\"Attack of the Clones\",\"4\":\"Zam Wesell\",\"5\":\"http://swapi.co/api/planets/54/\",\"6\":\"http://swapi.co/api/species/30/\",\"7\":\"Zolan\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/71/\",\"3\":\"Attack of the Clones\",\"4\":\"Dexter Jettster\",\"5\":\"http://swapi.co/api/planets/55/\",\"6\":\"http://swapi.co/api/species/31/\",\"7\":\"Ojom\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/72/\",\"3\":\"Attack of the Clones\",\"4\":\"Lama Su\",\"5\":\"http://swapi.co/api/planets/10/\",\"6\":\"http://swapi.co/api/species/32/\",\"7\":\"Kamino\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/73/\",\"3\":\"Attack of the Clones\",\"4\":\"Taun We\",\"5\":\"http://swapi.co/api/planets/10/\",\"6\":\"http://swapi.co/api/species/32/\",\"7\":\"Kamino\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/74/\",\"3\":\"Attack of the Clones\",\"4\":\"Jocasta Nu\",\"5\":\"http://swapi.co/api/planets/9/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Coruscant\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/75/\",\"3\":\"Attack of the Clones\",\"4\":\"R4-P17\",\"5\":\"http://swapi.co/api/planets/28/\",\"6\":\"NA\",\"7\":\"unknown\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/76/\",\"3\":\"Attack of the Clones\",\"4\":\"Wat Tambor\",\"5\":\"http://swapi.co/api/planets/56/\",\"6\":\"http://swapi.co/api/species/33/\",\"7\":\"Skako\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/77/\",\"3\":\"Attack of the Clones\",\"4\":\"San Hill\",\"5\":\"http://swapi.co/api/planets/57/\",\"6\":\"http://swapi.co/api/species/34/\",\"7\":\"Muunilinst\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/78/\",\"3\":\"Attack of the Clones\",\"4\":\"Shaak Ti\",\"5\":\"http://swapi.co/api/planets/58/\",\"6\":\"http://swapi.co/api/species/35/\",\"7\":\"Shili\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/82/\",\"3\":\"Attack of the Clones\",\"4\":\"Sly Moore\",\"5\":\"http://swapi.co/api/planets/60/\",\"6\":\"NA\",\"7\":\"Umbara\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/35/\",\"3\":\"Attack of the Clones\",\"4\":\"Padmé Amidala\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/2/\",\"3\":\"The Phantom Menace\",\"4\":\"C-3PO\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/2/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/3/\",\"3\":\"The Phantom Menace\",\"4\":\"R2-D2\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/2/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/10/\",\"3\":\"The Phantom Menace\",\"4\":\"Obi-Wan Kenobi\",\"5\":\"http://swapi.co/api/planets/20/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Stewjon\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/11/\",\"3\":\"The Phantom Menace\",\"4\":\"Anakin Skywalker\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/16/\",\"3\":\"The Phantom Menace\",\"4\":\"Jabba Desilijic Tiure\",\"5\":\"http://swapi.co/api/planets/24/\",\"6\":\"http://swapi.co/api/species/5/\",\"7\":\"Nal Hutta\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/20/\",\"3\":\"The Phantom Menace\",\"4\":\"Yoda\",\"5\":\"http://swapi.co/api/planets/28/\",\"6\":\"http://swapi.co/api/species/6/\",\"7\":\"unknown\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/21/\",\"3\":\"The Phantom Menace\",\"4\":\"Palpatine\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/32/\",\"3\":\"The Phantom Menace\",\"4\":\"Qui-Gon Jinn\",\"5\":\"http://swapi.co/api/planets/28/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"unknown\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/33/\",\"3\":\"The Phantom Menace\",\"4\":\"Nute Gunray\",\"5\":\"http://swapi.co/api/planets/18/\",\"6\":\"http://swapi.co/api/species/11/\",\"7\":\"Cato Neimoidia\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/34/\",\"3\":\"The Phantom Menace\",\"4\":\"Finis Valorum\",\"5\":\"http://swapi.co/api/planets/9/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Coruscant\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/36/\",\"3\":\"The Phantom Menace\",\"4\":\"Jar Jar Binks\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/12/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/37/\",\"3\":\"The Phantom Menace\",\"4\":\"Roos Tarpals\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/12/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/38/\",\"3\":\"The Phantom Menace\",\"4\":\"Rugor Nass\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/12/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/39/\",\"3\":\"The Phantom Menace\",\"4\":\"Ric Olié\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"NA\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/40/\",\"3\":\"The Phantom Menace\",\"4\":\"Watto\",\"5\":\"http://swapi.co/api/planets/34/\",\"6\":\"http://swapi.co/api/species/13/\",\"7\":\"Toydaria\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/41/\",\"3\":\"The Phantom Menace\",\"4\":\"Sebulba\",\"5\":\"http://swapi.co/api/planets/35/\",\"6\":\"http://swapi.co/api/species/14/\",\"7\":\"Malastare\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/42/\",\"3\":\"The Phantom Menace\",\"4\":\"Quarsh Panaka\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"NA\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/43/\",\"3\":\"The Phantom Menace\",\"4\":\"Shmi Skywalker\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/44/\",\"3\":\"The Phantom Menace\",\"4\":\"Darth Maul\",\"5\":\"http://swapi.co/api/planets/36/\",\"6\":\"http://swapi.co/api/species/22/\",\"7\":\"Dathomir\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/46/\",\"3\":\"The Phantom Menace\",\"4\":\"Ayla Secura\",\"5\":\"http://swapi.co/api/planets/37/\",\"6\":\"http://swapi.co/api/species/15/\",\"7\":\"Ryloth\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/48/\",\"3\":\"The Phantom Menace\",\"4\":\"Dud Bolt\",\"5\":\"http://swapi.co/api/planets/39/\",\"6\":\"http://swapi.co/api/species/17/\",\"7\":\"Vulpter\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/49/\",\"3\":\"The Phantom Menace\",\"4\":\"Gasgano\",\"5\":\"http://swapi.co/api/planets/40/\",\"6\":\"http://swapi.co/api/species/18/\",\"7\":\"Troiken\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/50/\",\"3\":\"The Phantom Menace\",\"4\":\"Ben Quadinaros\",\"5\":\"http://swapi.co/api/planets/41/\",\"6\":\"http://swapi.co/api/species/19/\",\"7\":\"Tund\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/51/\",\"3\":\"The Phantom Menace\",\"4\":\"Mace Windu\",\"5\":\"http://swapi.co/api/planets/42/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Haruun Kal\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/52/\",\"3\":\"The Phantom Menace\",\"4\":\"Ki-Adi-Mundi\",\"5\":\"http://swapi.co/api/planets/43/\",\"6\":\"http://swapi.co/api/species/20/\",\"7\":\"Cerea\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/53/\",\"3\":\"The Phantom Menace\",\"4\":\"Kit Fisto\",\"5\":\"http://swapi.co/api/planets/44/\",\"6\":\"http://swapi.co/api/species/21/\",\"7\":\"Glee Anselm\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/54/\",\"3\":\"The Phantom Menace\",\"4\":\"Eeth Koth\",\"5\":\"http://swapi.co/api/planets/45/\",\"6\":\"http://swapi.co/api/species/22/\",\"7\":\"Iridonia\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/55/\",\"3\":\"The Phantom Menace\",\"4\":\"Adi Gallia\",\"5\":\"http://swapi.co/api/planets/9/\",\"6\":\"http://swapi.co/api/species/23/\",\"7\":\"Coruscant\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/56/\",\"3\":\"The Phantom Menace\",\"4\":\"Saesee Tiin\",\"5\":\"http://swapi.co/api/planets/47/\",\"6\":\"http://swapi.co/api/species/24/\",\"7\":\"Iktotch\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/57/\",\"3\":\"The Phantom Menace\",\"4\":\"Yarael Poof\",\"5\":\"http://swapi.co/api/planets/48/\",\"6\":\"http://swapi.co/api/species/25/\",\"7\":\"Quermia\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/58/\",\"3\":\"The Phantom Menace\",\"4\":\"Plo Koon\",\"5\":\"http://swapi.co/api/planets/49/\",\"6\":\"http://swapi.co/api/species/26/\",\"7\":\"Dorin\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/59/\",\"3\":\"The Phantom Menace\",\"4\":\"Mas Amedda\",\"5\":\"http://swapi.co/api/planets/50/\",\"6\":\"http://swapi.co/api/species/27/\",\"7\":\"Champala\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/47/\",\"3\":\"The Phantom Menace\",\"4\":\"Ratts Tyerell\",\"5\":\"http://swapi.co/api/planets/38/\",\"6\":\"http://swapi.co/api/species/16/\",\"7\":\"Aleen Minor\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/35/\",\"3\":\"The Phantom Menace\",\"4\":\"Padmé Amidala\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/1/\",\"3\":\"Revenge of the Sith\",\"4\":\"Luke Skywalker\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/2/\",\"3\":\"Revenge of the Sith\",\"4\":\"C-3PO\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/2/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/3/\",\"3\":\"Revenge of the Sith\",\"4\":\"R2-D2\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/2/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/4/\",\"3\":\"Revenge of the Sith\",\"4\":\"Darth Vader\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/5/\",\"3\":\"Revenge of the Sith\",\"4\":\"Leia Organa\",\"5\":\"http://swapi.co/api/planets/2/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Alderaan\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/6/\",\"3\":\"Revenge of the Sith\",\"4\":\"Owen Lars\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/7/\",\"3\":\"Revenge of the Sith\",\"4\":\"Beru Whitesun lars\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/10/\",\"3\":\"Revenge of the Sith\",\"4\":\"Obi-Wan Kenobi\",\"5\":\"http://swapi.co/api/planets/20/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Stewjon\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/11/\",\"3\":\"Revenge of the Sith\",\"4\":\"Anakin Skywalker\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/12/\",\"3\":\"Revenge of the Sith\",\"4\":\"Wilhuff Tarkin\",\"5\":\"http://swapi.co/api/planets/21/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Eriadu\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/13/\",\"3\":\"Revenge of the Sith\",\"4\":\"Chewbacca\",\"5\":\"http://swapi.co/api/planets/14/\",\"6\":\"http://swapi.co/api/species/3/\",\"7\":\"Kashyyyk\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/20/\",\"3\":\"Revenge of the Sith\",\"4\":\"Yoda\",\"5\":\"http://swapi.co/api/planets/28/\",\"6\":\"http://swapi.co/api/species/6/\",\"7\":\"unknown\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/21/\",\"3\":\"Revenge of the Sith\",\"4\":\"Palpatine\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/33/\",\"3\":\"Revenge of the Sith\",\"4\":\"Nute Gunray\",\"5\":\"http://swapi.co/api/planets/18/\",\"6\":\"http://swapi.co/api/species/11/\",\"7\":\"Cato Neimoidia\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/46/\",\"3\":\"Revenge of the Sith\",\"4\":\"Ayla Secura\",\"5\":\"http://swapi.co/api/planets/37/\",\"6\":\"http://swapi.co/api/species/15/\",\"7\":\"Ryloth\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/51/\",\"3\":\"Revenge of the Sith\",\"4\":\"Mace Windu\",\"5\":\"http://swapi.co/api/planets/42/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Haruun Kal\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/52/\",\"3\":\"Revenge of the Sith\",\"4\":\"Ki-Adi-Mundi\",\"5\":\"http://swapi.co/api/planets/43/\",\"6\":\"http://swapi.co/api/species/20/\",\"7\":\"Cerea\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/53/\",\"3\":\"Revenge of the Sith\",\"4\":\"Kit Fisto\",\"5\":\"http://swapi.co/api/planets/44/\",\"6\":\"http://swapi.co/api/species/21/\",\"7\":\"Glee Anselm\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/54/\",\"3\":\"Revenge of the Sith\",\"4\":\"Eeth Koth\",\"5\":\"http://swapi.co/api/planets/45/\",\"6\":\"http://swapi.co/api/species/22/\",\"7\":\"Iridonia\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/55/\",\"3\":\"Revenge of the Sith\",\"4\":\"Adi Gallia\",\"5\":\"http://swapi.co/api/planets/9/\",\"6\":\"http://swapi.co/api/species/23/\",\"7\":\"Coruscant\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/56/\",\"3\":\"Revenge of the Sith\",\"4\":\"Saesee Tiin\",\"5\":\"http://swapi.co/api/planets/47/\",\"6\":\"http://swapi.co/api/species/24/\",\"7\":\"Iktotch\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/58/\",\"3\":\"Revenge of the Sith\",\"4\":\"Plo Koon\",\"5\":\"http://swapi.co/api/planets/49/\",\"6\":\"http://swapi.co/api/species/26/\",\"7\":\"Dorin\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/63/\",\"3\":\"Revenge of the Sith\",\"4\":\"Poggle the Lesser\",\"5\":\"http://swapi.co/api/planets/11/\",\"6\":\"http://swapi.co/api/species/28/\",\"7\":\"Geonosis\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/64/\",\"3\":\"Revenge of the Sith\",\"4\":\"Luminara Unduli\",\"5\":\"http://swapi.co/api/planets/51/\",\"6\":\"http://swapi.co/api/species/29/\",\"7\":\"Mirial\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/67/\",\"3\":\"Revenge of the Sith\",\"4\":\"Dooku\",\"5\":\"http://swapi.co/api/planets/52/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Serenno\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/68/\",\"3\":\"Revenge of the Sith\",\"4\":\"Bail Prestor Organa\",\"5\":\"http://swapi.co/api/planets/2/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Alderaan\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/75/\",\"3\":\"Revenge of the Sith\",\"4\":\"R4-P17\",\"5\":\"http://swapi.co/api/planets/28/\",\"6\":\"NA\",\"7\":\"unknown\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/78/\",\"3\":\"Revenge of the Sith\",\"4\":\"Shaak Ti\",\"5\":\"http://swapi.co/api/planets/58/\",\"6\":\"http://swapi.co/api/species/35/\",\"7\":\"Shili\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/79/\",\"3\":\"Revenge of the Sith\",\"4\":\"Grievous\",\"5\":\"http://swapi.co/api/planets/59/\",\"6\":\"http://swapi.co/api/species/36/\",\"7\":\"Kalee\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/80/\",\"3\":\"Revenge of the Sith\",\"4\":\"Tarfful\",\"5\":\"http://swapi.co/api/planets/14/\",\"6\":\"http://swapi.co/api/species/3/\",\"7\":\"Kashyyyk\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/81/\",\"3\":\"Revenge of the Sith\",\"4\":\"Raymus Antilles\",\"5\":\"http://swapi.co/api/planets/2/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Alderaan\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/82/\",\"3\":\"Revenge of the Sith\",\"4\":\"Sly Moore\",\"5\":\"http://swapi.co/api/planets/60/\",\"6\":\"NA\",\"7\":\"Umbara\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/83/\",\"3\":\"Revenge of the Sith\",\"4\":\"Tion Medon\",\"5\":\"http://swapi.co/api/planets/12/\",\"6\":\"http://swapi.co/api/species/37/\",\"7\":\"Utapau\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/35/\",\"3\":\"Revenge of the Sith\",\"4\":\"Padmé Amidala\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/1/\",\"3\":\"Return of the Jedi\",\"4\":\"Luke Skywalker\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/2/\",\"3\":\"Return of the Jedi\",\"4\":\"C-3PO\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/2/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/3/\",\"3\":\"Return of the Jedi\",\"4\":\"R2-D2\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/2/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/4/\",\"3\":\"Return of the Jedi\",\"4\":\"Darth Vader\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/5/\",\"3\":\"Return of the Jedi\",\"4\":\"Leia Organa\",\"5\":\"http://swapi.co/api/planets/2/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Alderaan\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/10/\",\"3\":\"Return of the Jedi\",\"4\":\"Obi-Wan Kenobi\",\"5\":\"http://swapi.co/api/planets/20/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Stewjon\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/13/\",\"3\":\"Return of the Jedi\",\"4\":\"Chewbacca\",\"5\":\"http://swapi.co/api/planets/14/\",\"6\":\"http://swapi.co/api/species/3/\",\"7\":\"Kashyyyk\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/14/\",\"3\":\"Return of the Jedi\",\"4\":\"Han Solo\",\"5\":\"http://swapi.co/api/planets/22/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Corellia\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/16/\",\"3\":\"Return of the Jedi\",\"4\":\"Jabba Desilijic Tiure\",\"5\":\"http://swapi.co/api/planets/24/\",\"6\":\"http://swapi.co/api/species/5/\",\"7\":\"Nal Hutta\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/18/\",\"3\":\"Return of the Jedi\",\"4\":\"Wedge Antilles\",\"5\":\"http://swapi.co/api/planets/22/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Corellia\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/20/\",\"3\":\"Return of the Jedi\",\"4\":\"Yoda\",\"5\":\"http://swapi.co/api/planets/28/\",\"6\":\"http://swapi.co/api/species/6/\",\"7\":\"unknown\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/21/\",\"3\":\"Return of the Jedi\",\"4\":\"Palpatine\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/22/\",\"3\":\"Return of the Jedi\",\"4\":\"Boba Fett\",\"5\":\"http://swapi.co/api/planets/10/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Kamino\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/25/\",\"3\":\"Return of the Jedi\",\"4\":\"Lando Calrissian\",\"5\":\"http://swapi.co/api/planets/30/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Socorro\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/27/\",\"3\":\"Return of the Jedi\",\"4\":\"Ackbar\",\"5\":\"http://swapi.co/api/planets/31/\",\"6\":\"http://swapi.co/api/species/8/\",\"7\":\"Mon Cala\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/28/\",\"3\":\"Return of the Jedi\",\"4\":\"Mon Mothma\",\"5\":\"http://swapi.co/api/planets/32/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Chandrila\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/29/\",\"3\":\"Return of the Jedi\",\"4\":\"Arvel Crynyd\",\"5\":\"http://swapi.co/api/planets/28/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"unknown\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/30/\",\"3\":\"Return of the Jedi\",\"4\":\"Wicket Systri Warrick\",\"5\":\"http://swapi.co/api/planets/7/\",\"6\":\"http://swapi.co/api/species/9/\",\"7\":\"Endor\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/31/\",\"3\":\"Return of the Jedi\",\"4\":\"Nien Nunb\",\"5\":\"http://swapi.co/api/planets/33/\",\"6\":\"http://swapi.co/api/species/10/\",\"7\":\"Sullust\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/45/\",\"3\":\"Return of the Jedi\",\"4\":\"Bib Fortuna\",\"5\":\"http://swapi.co/api/planets/37/\",\"6\":\"http://swapi.co/api/species/15/\",\"7\":\"Ryloth\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/1/\",\"3\":\"The Empire Strikes Back\",\"4\":\"Luke Skywalker\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/2/\",\"3\":\"The Empire Strikes Back\",\"4\":\"C-3PO\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/2/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/3/\",\"3\":\"The Empire Strikes Back\",\"4\":\"R2-D2\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/2/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/4/\",\"3\":\"The Empire Strikes Back\",\"4\":\"Darth Vader\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/5/\",\"3\":\"The Empire Strikes Back\",\"4\":\"Leia Organa\",\"5\":\"http://swapi.co/api/planets/2/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Alderaan\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/10/\",\"3\":\"The Empire Strikes Back\",\"4\":\"Obi-Wan Kenobi\",\"5\":\"http://swapi.co/api/planets/20/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Stewjon\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/13/\",\"3\":\"The Empire Strikes Back\",\"4\":\"Chewbacca\",\"5\":\"http://swapi.co/api/planets/14/\",\"6\":\"http://swapi.co/api/species/3/\",\"7\":\"Kashyyyk\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/14/\",\"3\":\"The Empire Strikes Back\",\"4\":\"Han Solo\",\"5\":\"http://swapi.co/api/planets/22/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Corellia\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/18/\",\"3\":\"The Empire Strikes Back\",\"4\":\"Wedge Antilles\",\"5\":\"http://swapi.co/api/planets/22/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Corellia\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/20/\",\"3\":\"The Empire Strikes Back\",\"4\":\"Yoda\",\"5\":\"http://swapi.co/api/planets/28/\",\"6\":\"http://swapi.co/api/species/6/\",\"7\":\"unknown\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/21/\",\"3\":\"The Empire Strikes Back\",\"4\":\"Palpatine\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/22/\",\"3\":\"The Empire Strikes Back\",\"4\":\"Boba Fett\",\"5\":\"http://swapi.co/api/planets/10/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Kamino\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/23/\",\"3\":\"The Empire Strikes Back\",\"4\":\"IG-88\",\"5\":\"http://swapi.co/api/planets/28/\",\"6\":\"http://swapi.co/api/species/2/\",\"7\":\"unknown\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/24/\",\"3\":\"The Empire Strikes Back\",\"4\":\"Bossk\",\"5\":\"http://swapi.co/api/planets/29/\",\"6\":\"http://swapi.co/api/species/7/\",\"7\":\"Trandosha\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/25/\",\"3\":\"The Empire Strikes Back\",\"4\":\"Lando Calrissian\",\"5\":\"http://swapi.co/api/planets/30/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Socorro\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/26/\",\"3\":\"The Empire Strikes Back\",\"4\":\"Lobot\",\"5\":\"http://swapi.co/api/planets/6/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Bespin\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/1/\",\"3\":\"The Force Awakens\",\"4\":\"Luke Skywalker\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/3/\",\"3\":\"The Force Awakens\",\"4\":\"R2-D2\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/2/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/5/\",\"3\":\"The Force Awakens\",\"4\":\"Leia Organa\",\"5\":\"http://swapi.co/api/planets/2/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Alderaan\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/13/\",\"3\":\"The Force Awakens\",\"4\":\"Chewbacca\",\"5\":\"http://swapi.co/api/planets/14/\",\"6\":\"http://swapi.co/api/species/3/\",\"7\":\"Kashyyyk\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/14/\",\"3\":\"The Force Awakens\",\"4\":\"Han Solo\",\"5\":\"http://swapi.co/api/planets/22/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Corellia\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/27/\",\"3\":\"The Force Awakens\",\"4\":\"Ackbar\",\"5\":\"http://swapi.co/api/planets/31/\",\"6\":\"http://swapi.co/api/species/8/\",\"7\":\"Mon Cala\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/84/\",\"3\":\"The Force Awakens\",\"4\":\"Finn\",\"5\":\"http://swapi.co/api/planets/28/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"unknown\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/85/\",\"3\":\"The Force Awakens\",\"4\":\"Rey\",\"5\":\"http://swapi.co/api/planets/28/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"unknown\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/86/\",\"3\":\"The Force Awakens\",\"4\":\"Poe Dameron\",\"5\":\"http://swapi.co/api/planets/28/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"unknown\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/87/\",\"3\":\"The Force Awakens\",\"4\":\"BB8\",\"5\":\"http://swapi.co/api/planets/28/\",\"6\":\"http://swapi.co/api/species/2/\",\"7\":\"unknown\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/88/\",\"3\":\"The Force Awakens\",\"4\":\"Captain Phasma\",\"5\":\"http://swapi.co/api/planets/28/\",\"6\":\"NA\",\"7\":\"unknown\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n作成した`data_films_x_characters_1`を使うことで，以下のように，登場人物の故郷の惑星の構成比をグラフにすることができます． このグラフへの考察はひとまず措くとして，リレーショナルデータモデルを用いることでデータフレームの結合を自動化できることが確認できました．\n\nしかし，上のような分析であれば，`left_join()`を用いてデータフレームを結合することも簡単で， あまりリレーショナルデータモデルを用いるメリットが感じられないかもしれません． そこで応用編では，リレーショナルデータモデルが本領を発揮する，より込み入った状況を考えてみます．\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"登場人物の故郷の惑星の構成比のグラフ\"}\ndata_films_x_characters_1 |> \n  mutate(name.planets = fct_lump_n(name.planets, 7,\n                                   ties.method = \"first\") |> \n           fct_relevel(\"Other\", \n                       after = Inf)) |> \n  count(title, name.planets) |> \n  mutate(prop = n / sum(n),\n         .by = title,\n         .keep = \"unused\") |> \n  ggplot(aes(fct_rev(title), prop,\n             fill = name.planets)) +\n  geom_col(position = position_stack(reverse = TRUE)) +\n  geom_text(aes(label = if_else(prop < 5e-2, \n                                \"\",\n                                scales::label_percent(accuracy = 1)(prop))),\n            position = position_stack(vjust = 0.5,\n                                      reverse = TRUE)) +\n  scale_x_discrete(\"作品タイトル\") +\n  scale_y_continuous(\"登場人物の故郷の惑星の構成比\",\n                     labels = scales::percent) +\n  scale_fill_brewer(\"惑星名\",\n                    palette = \"Set2\") +\n  coord_flip() +\n  theme(legend.position = \"bottom\") +\n  guides(fill = guide_legend(nrow = 2,\n                             byrow = TRUE))\n```\n\n::: {.cell-output-display}\n![](relational-data-models-with-r-s-dm_files/figure-html/plot-starwars-1-1.png){width=672}\n:::\n:::\n\n\n### 2. 応用編：StarWars作品の登場人物の種族の構成比を調べる\n\n応用編では，StarWars作品の登場人物の種族の構成比を調べてみます． この分析の難易度は基礎編とさほど変わりませんが，通常，扱うデータが増えるとコードが煩雑化しやすいため，リレーショナルデータモデルのメリットが大きくなります． さらに，リレーショナルデータモデルのメリットには，以下のようなものもあります．\n\n-   既存のリレーショナルデータモデルに新たなデータを追加することが可能\n-   結合のためのキーの整合性を確認することが可能\n\nあらかじめ，この分析で必要となる`species`データを準備しておきます．\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspecies <- tibble(species = sw_species) |> \n  unnest_wider(species) |> \n  select(url, name)\n\nspecies\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"url\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"name\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"http://swapi.co/api/species/5/\",\"2\":\"Hutt\"},{\"1\":\"http://swapi.co/api/species/6/\",\"2\":\"Yoda's species\"},{\"1\":\"http://swapi.co/api/species/7/\",\"2\":\"Trandoshan\"},{\"1\":\"http://swapi.co/api/species/8/\",\"2\":\"Mon Calamari\"},{\"1\":\"http://swapi.co/api/species/9/\",\"2\":\"Ewok\"},{\"1\":\"http://swapi.co/api/species/10/\",\"2\":\"Sullustan\"},{\"1\":\"http://swapi.co/api/species/11/\",\"2\":\"Neimodian\"},{\"1\":\"http://swapi.co/api/species/12/\",\"2\":\"Gungan\"},{\"1\":\"http://swapi.co/api/species/13/\",\"2\":\"Toydarian\"},{\"1\":\"http://swapi.co/api/species/14/\",\"2\":\"Dug\"},{\"1\":\"http://swapi.co/api/species/15/\",\"2\":\"Twi'lek\"},{\"1\":\"http://swapi.co/api/species/16/\",\"2\":\"Aleena\"},{\"1\":\"http://swapi.co/api/species/17/\",\"2\":\"Vulptereen\"},{\"1\":\"http://swapi.co/api/species/18/\",\"2\":\"Xexto\"},{\"1\":\"http://swapi.co/api/species/19/\",\"2\":\"Toong\"},{\"1\":\"http://swapi.co/api/species/20/\",\"2\":\"Cerean\"},{\"1\":\"http://swapi.co/api/species/21/\",\"2\":\"Nautolan\"},{\"1\":\"http://swapi.co/api/species/22/\",\"2\":\"Zabrak\"},{\"1\":\"http://swapi.co/api/species/23/\",\"2\":\"Tholothian\"},{\"1\":\"http://swapi.co/api/species/24/\",\"2\":\"Iktotchi\"},{\"1\":\"http://swapi.co/api/species/25/\",\"2\":\"Quermian\"},{\"1\":\"http://swapi.co/api/species/26/\",\"2\":\"Kel Dor\"},{\"1\":\"http://swapi.co/api/species/27/\",\"2\":\"Chagrian\"},{\"1\":\"http://swapi.co/api/species/28/\",\"2\":\"Geonosian\"},{\"1\":\"http://swapi.co/api/species/29/\",\"2\":\"Mirialan\"},{\"1\":\"http://swapi.co/api/species/30/\",\"2\":\"Clawdite\"},{\"1\":\"http://swapi.co/api/species/31/\",\"2\":\"Besalisk\"},{\"1\":\"http://swapi.co/api/species/32/\",\"2\":\"Kaminoan\"},{\"1\":\"http://swapi.co/api/species/33/\",\"2\":\"Skakoan\"},{\"1\":\"http://swapi.co/api/species/34/\",\"2\":\"Muun\"},{\"1\":\"http://swapi.co/api/species/35/\",\"2\":\"Togruta\"},{\"1\":\"http://swapi.co/api/species/36/\",\"2\":\"Kaleesh\"},{\"1\":\"http://swapi.co/api/species/37/\",\"2\":\"Pau'an\"},{\"1\":\"http://swapi.co/api/species/3/\",\"2\":\"Wookiee\"},{\"1\":\"http://swapi.co/api/species/2/\",\"2\":\"Droid\"},{\"1\":\"http://swapi.co/api/species/1/\",\"2\":\"Human\"},{\"1\":\"http://swapi.co/api/species/4/\",\"2\":\"Rodian\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\ndmでは，`dm()`を用いて，リレーショナルデータモデルに新たにデータを追加することができます． ここでは，`dm_starwars_1`に`species`データを追加して，`dm_starwars_2`を作成してみましょう． `dm_draw()`を用いることで，モデルが更新されたことがわかります．\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndm_starwars_2 <- dm_starwars_1 |> \n  dm(species) |> \n  dm_add_pk(species, url) |> \n  dm_add_fk(people, species, species)\n\ndm_draw(dm_starwars_2)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"grViz html-widget html-fill-item\" id=\"htmlwidget-61b268b63f626acddaab\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-61b268b63f626acddaab\">{\"x\":{\"diagram\":\"#data_model\\ndigraph {\\ngraph [rankdir=LR tooltip=\\\"Data Model\\\" ]\\n\\nnode [margin=0 fontcolor = \\\"#444444\\\" ]\\n\\nedge [color = \\\"#555555\\\", arrowsize = 1, ]\\n\\npack=true\\npackmode= \\\"node\\\"\\n\\n  \\\"films\\\" [id = \\\"films\\\", label = <<TABLE ALIGN=\\\"LEFT\\\" BORDER=\\\"1\\\" CELLBORDER=\\\"0\\\" CELLSPACING=\\\"0\\\" COLOR=\\\"#555555\\\">\\n    <TR>\\n      <TD COLSPAN=\\\"1\\\" BGCOLOR=\\\"#EFEBDD\\\" BORDER=\\\"0\\\"><FONT COLOR=\\\"#000000\\\">films<\\/FONT>\\n<\\/TD>\\n    <\\/TR>\\n    <TR>\\n      <TD ALIGN=\\\"LEFT\\\" BGCOLOR=\\\"#FFFFFF\\\" PORT=\\\"url\\\"><U>url<\\/U><\\/TD>\\n    <\\/TR>\\n  <\\/TABLE>>, shape = \\\"plaintext\\\"] \\n\\n  \\\"films_x_characters\\\" [id = \\\"films_x_characters\\\", label = <<TABLE ALIGN=\\\"LEFT\\\" BORDER=\\\"1\\\" CELLBORDER=\\\"0\\\" CELLSPACING=\\\"0\\\" COLOR=\\\"#555555\\\">\\n    <TR>\\n      <TD COLSPAN=\\\"1\\\" BGCOLOR=\\\"#EFEBDD\\\" BORDER=\\\"0\\\"><FONT COLOR=\\\"#000000\\\">films_x_characters<\\/FONT>\\n<\\/TD>\\n    <\\/TR>\\n    <TR>\\n      <TD ALIGN=\\\"LEFT\\\" BGCOLOR=\\\"#FFFFFF\\\" PORT=\\\"url\\\">url<\\/TD>\\n    <\\/TR>\\n    <TR>\\n      <TD ALIGN=\\\"LEFT\\\" BGCOLOR=\\\"#FFFFFF\\\" PORT=\\\"characters\\\">characters<\\/TD>\\n    <\\/TR>\\n    <TR>\\n      <TD ALIGN=\\\"LEFT\\\" BGCOLOR=\\\"#FFFFFF\\\" PORT=\\\"url, characters\\\"><U>url, characters<\\/U><\\/TD>\\n    <\\/TR>\\n  <\\/TABLE>>, shape = \\\"plaintext\\\"] \\n\\n  \\\"people\\\" [id = \\\"people\\\", label = <<TABLE ALIGN=\\\"LEFT\\\" BORDER=\\\"1\\\" CELLBORDER=\\\"0\\\" CELLSPACING=\\\"0\\\" COLOR=\\\"#555555\\\">\\n    <TR>\\n      <TD COLSPAN=\\\"1\\\" BGCOLOR=\\\"#EFEBDD\\\" BORDER=\\\"0\\\"><FONT COLOR=\\\"#000000\\\">people<\\/FONT>\\n<\\/TD>\\n    <\\/TR>\\n    <TR>\\n      <TD ALIGN=\\\"LEFT\\\" BGCOLOR=\\\"#FFFFFF\\\" PORT=\\\"url\\\"><U>url<\\/U><\\/TD>\\n    <\\/TR>\\n    <TR>\\n      <TD ALIGN=\\\"LEFT\\\" BGCOLOR=\\\"#FFFFFF\\\" PORT=\\\"homeworld\\\">homeworld<\\/TD>\\n    <\\/TR>\\n    <TR>\\n      <TD ALIGN=\\\"LEFT\\\" BGCOLOR=\\\"#FFFFFF\\\" PORT=\\\"species\\\">species<\\/TD>\\n    <\\/TR>\\n  <\\/TABLE>>, shape = \\\"plaintext\\\"] \\n\\n  \\\"planets\\\" [id = \\\"planets\\\", label = <<TABLE ALIGN=\\\"LEFT\\\" BORDER=\\\"1\\\" CELLBORDER=\\\"0\\\" CELLSPACING=\\\"0\\\" COLOR=\\\"#555555\\\">\\n    <TR>\\n      <TD COLSPAN=\\\"1\\\" BGCOLOR=\\\"#EFEBDD\\\" BORDER=\\\"0\\\"><FONT COLOR=\\\"#000000\\\">planets<\\/FONT>\\n<\\/TD>\\n    <\\/TR>\\n    <TR>\\n      <TD ALIGN=\\\"LEFT\\\" BGCOLOR=\\\"#FFFFFF\\\" PORT=\\\"url\\\"><U>url<\\/U><\\/TD>\\n    <\\/TR>\\n  <\\/TABLE>>, shape = \\\"plaintext\\\"] \\n\\n  \\\"species\\\" [id = \\\"species\\\", label = <<TABLE ALIGN=\\\"LEFT\\\" BORDER=\\\"1\\\" CELLBORDER=\\\"0\\\" CELLSPACING=\\\"0\\\" COLOR=\\\"#555555\\\">\\n    <TR>\\n      <TD COLSPAN=\\\"1\\\" BGCOLOR=\\\"#EFEBDD\\\" BORDER=\\\"0\\\"><FONT COLOR=\\\"#000000\\\">species<\\/FONT>\\n<\\/TD>\\n    <\\/TR>\\n    <TR>\\n      <TD ALIGN=\\\"LEFT\\\" BGCOLOR=\\\"#FFFFFF\\\" PORT=\\\"url\\\"><U>url<\\/U><\\/TD>\\n    <\\/TR>\\n  <\\/TABLE>>, shape = \\\"plaintext\\\"] \\n\\n\\\"films_x_characters\\\":\\\"url\\\"->\\\"films\\\":\\\"url\\\" [id=\\\"films_x_characters_1\\\"]\\n\\\"films_x_characters\\\":\\\"characters\\\"->\\\"people\\\":\\\"url\\\" [id=\\\"films_x_characters_2\\\"]\\n\\\"people\\\":\\\"homeworld\\\"->\\\"planets\\\":\\\"url\\\" [id=\\\"people_1\\\"]\\n\\\"people\\\":\\\"species\\\"->\\\"species\\\":\\\"url\\\" [id=\\\"people_2\\\"]\\n}\",\"config\":{\"engine\":null,\"options\":null}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n次に，結合のためのキーの整合性を確認してみましょう．こうした検証は，`dm_examine_constraints()`を用いることで可能です． ここでは，上でありがちなミスとして挙げた，2種類のミスを起こしたモデルを作成して，`dm_examine_constraints()`の挙動を確認してみましょう． ここで，`dm_starwars_2_wrong_data`は，`species`データの1行目が削除されたデータで，データがMECE（「漏れなく・ダブりなく」）でないものです． また，`dm_starwars_2_wrong_pk`は，`species`データの主キーを取り違えたものです．\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndm_starwars_2_wrong_data <- dm_starwars_1 |> \n  dm(species = species |> \n       slice(-1)) |> \n  dm_add_pk(species, url) |> \n  dm_add_fk(people, species, species)\n\ndm_starwars_2_wrong_pk <- dm_starwars_1 |> \n  dm(species) |> \n  dm_add_pk(species, name) |> \n  dm_add_fk(people, species, species)\n```\n:::\n\n\n`dm_examine_constraints()`の結果を見てみましょう． 正しいモデルである`dm_starwars_2`では，`ℹ All constraints satisfied.`というメッセージが表示され，モデルのキーが整合していることがわかります． 一方で，`dm_starwars_2_wrong_data`と`dm_starwars_2_wrong_pk`では，`! Unsatisfied constraints:`というメッセージが表示されています． これは，`species`データの主キーに含まれるはずのデータが含まれていないことに起因します． このように，`dm_examine_constraints()`を用いることで，簡単にモデルのキーの整合性を確認することができます．\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprint(dm_examine_constraints(dm_starwars_2))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nℹ All constraints satisfied.\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(dm_examine_constraints(dm_starwars_2_wrong_data))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n! Unsatisfied constraints:\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n• Table `people`: foreign key `species` into table `species`: values of `people$species` not in `species$url`: http://swapi.co/api/species/5/ (1)\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(dm_examine_constraints(dm_starwars_2_wrong_pk))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n! Unsatisfied constraints:\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n• Table `people`: foreign key `species` into table `species`: values of `people$species` not in `species$name`: http://swapi.co/api/species/1/ (35), http://swapi.co/api/species/2/ (5), http://swapi.co/api/species/12/ (3), http://swapi.co/api/species/15/ (2), http://swapi.co/api/species/22/ (2), …\n```\n\n\n:::\n:::\n\n\n以上のように，dmでは，`dm()`でリレーショナルデータモデルに新たなデータを追加したり，`dm_examine_constraints()`で結合のためのキーの整合性を確認したりすることができることがわかりました． 最後に，作成したリレーショナルデータモデル`dm_starwars_2`を用いて，StarWars作品の登場人物の種族の構成比をグラフ化したものが以下の図です．ここでも，考察は割愛します．\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"登場人物の故郷の種族の構成比のグラフ\"}\ndm_starwars_2 |> \n  dm_flatten_to_tbl(films_x_characters,\n                    .recursive = TRUE) |> \n  mutate(name.species = name.species |> \n           fct_na_value_to_level(\"Other\") |> \n           fct_lump_n(7,\n                      ties.method = \"first\") |> \n           fct_relevel(\"Other\", \n                       after = Inf)) |> \n  count(title, name.species) |> \n  mutate(prop = n / sum(n),\n         .by = title,\n         .keep = \"unused\") |> \n  ggplot(aes(fct_rev(title), prop,\n             fill = name.species)) +\n  geom_col(position = position_stack(reverse = TRUE)) +\n  geom_text(aes(label = if_else(prop < 5e-2, \n                                \"\",\n                                scales::label_percent(accuracy = 1)(prop))),\n            position = position_stack(vjust = 0.5,\n                                      reverse = TRUE)) +\n  scale_x_discrete(\"作品タイトル\") +\n  scale_y_continuous(\"登場人物の故郷の種族の構成比\",\n                     labels = scales::percent) +\n  scale_fill_brewer(\"種族名\",\n                    palette = \"Set2\") +\n  coord_flip() +\n  theme(legend.position = \"bottom\") +\n  guides(fill = guide_legend(nrow = 2,\n                             byrow = TRUE))\n```\n\n::: {.cell-output-display}\n![](relational-data-models-with-r-s-dm_files/figure-html/plot-starwars-2-1.png){width=672}\n:::\n:::\n\n\n## まとめ\n\nこの記事では，dmを使ってリレーショナルデータモデルを構築する方法を紹介しました． dmを使って，ひとたびリレーショナルデータモデルを構築してしまえば， データ間の関係を自ら管理する必要がなくなり，`dm_flatten_to_tbl()`でデータの結合を自動的に行うことができます． それ以外にも，dmでは，`dm()`によるモデル拡張や`dm_examine_constraints()`結合のためのキーの整合性の確認など， データ前処理の質を高めるための便利な機能が提供されています．\n\n## 参考文献\n\n-   [dmパッケージのサイト](https://dm.cynkra.com/index.html)\n-   [前処理大全［データ分析のためのSQL/R/Python実践テクニック］](https://gihyo.jp/book/2018/978-4-7741-9647-3)\n",
    "supporting": [
      "relational-data-models-with-r-s-dm_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<script src=\"../../../site_libs/viz-1.8.2/viz.js\"></script>\n<link href=\"../../../site_libs/DiagrammeR-styles-0.2/styles.css\" rel=\"stylesheet\" />\n<script src=\"../../../site_libs/grViz-binding-1.0.10/grViz.js\"></script>\n<link href=\"../../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}