{
  "hash": "282251f121cede3d3ea91f5f29f5888c",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Improve the quality of data preprocessing with R's dm package\"\nlang: en\ncategories: [dm, R, English]\ndate: \"2024-01-28\"\nformat:\n  html:\n    mermaid:\n      theme: default\n    df-print: paged\nimage: relational-data-models-with-r-s-dm/mermaid-figure-2.png\n---\n\n\nNote: This article is a machine-translated translation of [my Japanese article](https://uchidamizuki.quarto.pub/blog/posts/2024/01/relational-data-models-with-r-s-dm.html) with simple modifications.\n\n## How do we reduce errors in data preprocessing?\n\nIt is said that 80% of the time required for data analysis is spent on preprocessing. Even though preprocessing determines the quality of subsequent data analysis, the more time spent on pre-processing means the probability of making mistakes is also high.\n\nPreprocessing tasks include \"extraction,\" \"aggregation,\" and \"joining (merging)\" of data frames. Among these, data joining is a task that tends to make the code longer and more prone to errors. And since the data frames needed for analysis are rarely combined into one, joining data frames is a widespread process.\n\nTypical mistakes that tend to occur when joining data frames are as follows[^1],\n\n[^1]: Fortunately, recent versions of dplyr warn against duplicate keys when joining data frames.\n\n-   The keys of the data frame to be joined are not \"[MECE](https://en.wikipedia.org/wiki/MECE_principle)\"\n-   Mistaken keys to join data frames\n\nIf you have experienced any mistakes or near-misses in joining data frames, you may be better off relying on some sort of package instead of letting them go unattended. Besides, even if there were no mistakes, we tend to be skeptical about whether we did the right thing in the past.\n\nThis article introduces the R dm package, a powerful solution to the problems of errors and skepticism in joining data frames.\n\n## Relational data model with dm\n\nThe relational data model provided by dm manages the relationships among multiple data on our behalf.\n\nThis article describes the use and advantages of the relational data model provided by dm. the Star Wars data set provided by the repurrrsive package. For this purpose, let's use the Star Wars dataset provided by the repurrrsive package. tidyverse, dm, and repurrrsive packages must be pre-loaded.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(dm)\nlibrary(repurrrsive)\n```\n:::\n\n\nThe Star Wars dataset provided by repurrrsive includes the followings[^2].\n\n[^2]: Among the data exported by repurrrsive, the data whose name begins with `sw_` are related to StarWars, and the part after `sw_` represents the content of the data.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"StarWars dataset provided by repurrrsive\"}\ndata(package = \"repurrrsive\") |> \n  chuck(\"results\") |> \n  as_tibble() |> \n  filter(str_starts(Item, \"sw_\")) |> \n  pull(Item)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"sw_films\"     \"sw_people\"    \"sw_planets\"   \"sw_species\"   \"sw_starships\"\n[6] \"sw_vehicles\" \n```\n\n\n:::\n:::\n\n\nThis article will illustrate the use of the relational data model through the following two analytical examples. These examples require dealing with relationships among multiple data sets.\n\n1.  Basic: Building a relational data model with dm\n2.  Application: Extending the model and validating keys with dm\n\n### 1. Basic: Building a relational data model with dm\n\nAs a basic example, let us build a relational data model to determine the composition ratio of the home planets of the characters in Star Wars movies. To perform this analysis, three data frames, `films`, `people`, and `planets`, are prepared as shown below. Here, only the necessary data are selected to simplify the analysis[^3]．\n\n[^3]: The `species` column of `sw_people` is not needed here, but is selected for use in the next analysis.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfilms <- tibble(film = sw_films) |> \n  unnest_wider(film) |> \n  select(url, title, characters)\npeople <- tibble(person = sw_people) |>\n  unnest_wider(person) |> \n  select(url, name, homeworld, species)\nplanets <- tibble(planet = sw_planets) |>\n  unnest_wider(planet) |> \n  select(url, name)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfilms\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"url\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"title\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"characters\"],\"name\":[3],\"type\":[\"list\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"A New Hope\",\"3\":\"<chr [18]>\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"Attack of the Clones\",\"3\":\"<chr [40]>\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"The Phantom Menace\",\"3\":\"<chr [34]>\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"Revenge of the Sith\",\"3\":\"<chr [34]>\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"Return of the Jedi\",\"3\":\"<chr [20]>\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"The Empire Strikes Back\",\"3\":\"<chr [16]>\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"The Force Awakens\",\"3\":\"<chr [11]>\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\npeople\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"url\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"name\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"homeworld\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"species\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"http://swapi.co/api/people/1/\",\"2\":\"Luke Skywalker\",\"3\":\"http://swapi.co/api/planets/1/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/2/\",\"2\":\"C-3PO\",\"3\":\"http://swapi.co/api/planets/1/\",\"4\":\"http://swapi.co/api/species/2/\"},{\"1\":\"http://swapi.co/api/people/3/\",\"2\":\"R2-D2\",\"3\":\"http://swapi.co/api/planets/8/\",\"4\":\"http://swapi.co/api/species/2/\"},{\"1\":\"http://swapi.co/api/people/4/\",\"2\":\"Darth Vader\",\"3\":\"http://swapi.co/api/planets/1/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/5/\",\"2\":\"Leia Organa\",\"3\":\"http://swapi.co/api/planets/2/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/6/\",\"2\":\"Owen Lars\",\"3\":\"http://swapi.co/api/planets/1/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/7/\",\"2\":\"Beru Whitesun lars\",\"3\":\"http://swapi.co/api/planets/1/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/8/\",\"2\":\"R5-D4\",\"3\":\"http://swapi.co/api/planets/1/\",\"4\":\"http://swapi.co/api/species/2/\"},{\"1\":\"http://swapi.co/api/people/9/\",\"2\":\"Biggs Darklighter\",\"3\":\"http://swapi.co/api/planets/1/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/10/\",\"2\":\"Obi-Wan Kenobi\",\"3\":\"http://swapi.co/api/planets/20/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/11/\",\"2\":\"Anakin Skywalker\",\"3\":\"http://swapi.co/api/planets/1/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/12/\",\"2\":\"Wilhuff Tarkin\",\"3\":\"http://swapi.co/api/planets/21/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/13/\",\"2\":\"Chewbacca\",\"3\":\"http://swapi.co/api/planets/14/\",\"4\":\"http://swapi.co/api/species/3/\"},{\"1\":\"http://swapi.co/api/people/14/\",\"2\":\"Han Solo\",\"3\":\"http://swapi.co/api/planets/22/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/15/\",\"2\":\"Greedo\",\"3\":\"http://swapi.co/api/planets/23/\",\"4\":\"http://swapi.co/api/species/4/\"},{\"1\":\"http://swapi.co/api/people/16/\",\"2\":\"Jabba Desilijic Tiure\",\"3\":\"http://swapi.co/api/planets/24/\",\"4\":\"http://swapi.co/api/species/5/\"},{\"1\":\"http://swapi.co/api/people/18/\",\"2\":\"Wedge Antilles\",\"3\":\"http://swapi.co/api/planets/22/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/19/\",\"2\":\"Jek Tono Porkins\",\"3\":\"http://swapi.co/api/planets/26/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/20/\",\"2\":\"Yoda\",\"3\":\"http://swapi.co/api/planets/28/\",\"4\":\"http://swapi.co/api/species/6/\"},{\"1\":\"http://swapi.co/api/people/21/\",\"2\":\"Palpatine\",\"3\":\"http://swapi.co/api/planets/8/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/22/\",\"2\":\"Boba Fett\",\"3\":\"http://swapi.co/api/planets/10/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/23/\",\"2\":\"IG-88\",\"3\":\"http://swapi.co/api/planets/28/\",\"4\":\"http://swapi.co/api/species/2/\"},{\"1\":\"http://swapi.co/api/people/24/\",\"2\":\"Bossk\",\"3\":\"http://swapi.co/api/planets/29/\",\"4\":\"http://swapi.co/api/species/7/\"},{\"1\":\"http://swapi.co/api/people/25/\",\"2\":\"Lando Calrissian\",\"3\":\"http://swapi.co/api/planets/30/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/26/\",\"2\":\"Lobot\",\"3\":\"http://swapi.co/api/planets/6/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/27/\",\"2\":\"Ackbar\",\"3\":\"http://swapi.co/api/planets/31/\",\"4\":\"http://swapi.co/api/species/8/\"},{\"1\":\"http://swapi.co/api/people/28/\",\"2\":\"Mon Mothma\",\"3\":\"http://swapi.co/api/planets/32/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/29/\",\"2\":\"Arvel Crynyd\",\"3\":\"http://swapi.co/api/planets/28/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/30/\",\"2\":\"Wicket Systri Warrick\",\"3\":\"http://swapi.co/api/planets/7/\",\"4\":\"http://swapi.co/api/species/9/\"},{\"1\":\"http://swapi.co/api/people/31/\",\"2\":\"Nien Nunb\",\"3\":\"http://swapi.co/api/planets/33/\",\"4\":\"http://swapi.co/api/species/10/\"},{\"1\":\"http://swapi.co/api/people/32/\",\"2\":\"Qui-Gon Jinn\",\"3\":\"http://swapi.co/api/planets/28/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/33/\",\"2\":\"Nute Gunray\",\"3\":\"http://swapi.co/api/planets/18/\",\"4\":\"http://swapi.co/api/species/11/\"},{\"1\":\"http://swapi.co/api/people/34/\",\"2\":\"Finis Valorum\",\"3\":\"http://swapi.co/api/planets/9/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/36/\",\"2\":\"Jar Jar Binks\",\"3\":\"http://swapi.co/api/planets/8/\",\"4\":\"http://swapi.co/api/species/12/\"},{\"1\":\"http://swapi.co/api/people/37/\",\"2\":\"Roos Tarpals\",\"3\":\"http://swapi.co/api/planets/8/\",\"4\":\"http://swapi.co/api/species/12/\"},{\"1\":\"http://swapi.co/api/people/38/\",\"2\":\"Rugor Nass\",\"3\":\"http://swapi.co/api/planets/8/\",\"4\":\"http://swapi.co/api/species/12/\"},{\"1\":\"http://swapi.co/api/people/39/\",\"2\":\"Ric Olié\",\"3\":\"http://swapi.co/api/planets/8/\",\"4\":\"NA\"},{\"1\":\"http://swapi.co/api/people/40/\",\"2\":\"Watto\",\"3\":\"http://swapi.co/api/planets/34/\",\"4\":\"http://swapi.co/api/species/13/\"},{\"1\":\"http://swapi.co/api/people/41/\",\"2\":\"Sebulba\",\"3\":\"http://swapi.co/api/planets/35/\",\"4\":\"http://swapi.co/api/species/14/\"},{\"1\":\"http://swapi.co/api/people/42/\",\"2\":\"Quarsh Panaka\",\"3\":\"http://swapi.co/api/planets/8/\",\"4\":\"NA\"},{\"1\":\"http://swapi.co/api/people/43/\",\"2\":\"Shmi Skywalker\",\"3\":\"http://swapi.co/api/planets/1/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/44/\",\"2\":\"Darth Maul\",\"3\":\"http://swapi.co/api/planets/36/\",\"4\":\"http://swapi.co/api/species/22/\"},{\"1\":\"http://swapi.co/api/people/45/\",\"2\":\"Bib Fortuna\",\"3\":\"http://swapi.co/api/planets/37/\",\"4\":\"http://swapi.co/api/species/15/\"},{\"1\":\"http://swapi.co/api/people/46/\",\"2\":\"Ayla Secura\",\"3\":\"http://swapi.co/api/planets/37/\",\"4\":\"http://swapi.co/api/species/15/\"},{\"1\":\"http://swapi.co/api/people/48/\",\"2\":\"Dud Bolt\",\"3\":\"http://swapi.co/api/planets/39/\",\"4\":\"http://swapi.co/api/species/17/\"},{\"1\":\"http://swapi.co/api/people/49/\",\"2\":\"Gasgano\",\"3\":\"http://swapi.co/api/planets/40/\",\"4\":\"http://swapi.co/api/species/18/\"},{\"1\":\"http://swapi.co/api/people/50/\",\"2\":\"Ben Quadinaros\",\"3\":\"http://swapi.co/api/planets/41/\",\"4\":\"http://swapi.co/api/species/19/\"},{\"1\":\"http://swapi.co/api/people/51/\",\"2\":\"Mace Windu\",\"3\":\"http://swapi.co/api/planets/42/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/52/\",\"2\":\"Ki-Adi-Mundi\",\"3\":\"http://swapi.co/api/planets/43/\",\"4\":\"http://swapi.co/api/species/20/\"},{\"1\":\"http://swapi.co/api/people/53/\",\"2\":\"Kit Fisto\",\"3\":\"http://swapi.co/api/planets/44/\",\"4\":\"http://swapi.co/api/species/21/\"},{\"1\":\"http://swapi.co/api/people/54/\",\"2\":\"Eeth Koth\",\"3\":\"http://swapi.co/api/planets/45/\",\"4\":\"http://swapi.co/api/species/22/\"},{\"1\":\"http://swapi.co/api/people/55/\",\"2\":\"Adi Gallia\",\"3\":\"http://swapi.co/api/planets/9/\",\"4\":\"http://swapi.co/api/species/23/\"},{\"1\":\"http://swapi.co/api/people/56/\",\"2\":\"Saesee Tiin\",\"3\":\"http://swapi.co/api/planets/47/\",\"4\":\"http://swapi.co/api/species/24/\"},{\"1\":\"http://swapi.co/api/people/57/\",\"2\":\"Yarael Poof\",\"3\":\"http://swapi.co/api/planets/48/\",\"4\":\"http://swapi.co/api/species/25/\"},{\"1\":\"http://swapi.co/api/people/58/\",\"2\":\"Plo Koon\",\"3\":\"http://swapi.co/api/planets/49/\",\"4\":\"http://swapi.co/api/species/26/\"},{\"1\":\"http://swapi.co/api/people/59/\",\"2\":\"Mas Amedda\",\"3\":\"http://swapi.co/api/planets/50/\",\"4\":\"http://swapi.co/api/species/27/\"},{\"1\":\"http://swapi.co/api/people/60/\",\"2\":\"Gregar Typho\",\"3\":\"http://swapi.co/api/planets/8/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/61/\",\"2\":\"Cordé\",\"3\":\"http://swapi.co/api/planets/8/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/62/\",\"2\":\"Cliegg Lars\",\"3\":\"http://swapi.co/api/planets/1/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/63/\",\"2\":\"Poggle the Lesser\",\"3\":\"http://swapi.co/api/planets/11/\",\"4\":\"http://swapi.co/api/species/28/\"},{\"1\":\"http://swapi.co/api/people/64/\",\"2\":\"Luminara Unduli\",\"3\":\"http://swapi.co/api/planets/51/\",\"4\":\"http://swapi.co/api/species/29/\"},{\"1\":\"http://swapi.co/api/people/65/\",\"2\":\"Barriss Offee\",\"3\":\"http://swapi.co/api/planets/51/\",\"4\":\"http://swapi.co/api/species/29/\"},{\"1\":\"http://swapi.co/api/people/66/\",\"2\":\"Dormé\",\"3\":\"http://swapi.co/api/planets/8/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/67/\",\"2\":\"Dooku\",\"3\":\"http://swapi.co/api/planets/52/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/68/\",\"2\":\"Bail Prestor Organa\",\"3\":\"http://swapi.co/api/planets/2/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/69/\",\"2\":\"Jango Fett\",\"3\":\"http://swapi.co/api/planets/53/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/70/\",\"2\":\"Zam Wesell\",\"3\":\"http://swapi.co/api/planets/54/\",\"4\":\"http://swapi.co/api/species/30/\"},{\"1\":\"http://swapi.co/api/people/71/\",\"2\":\"Dexter Jettster\",\"3\":\"http://swapi.co/api/planets/55/\",\"4\":\"http://swapi.co/api/species/31/\"},{\"1\":\"http://swapi.co/api/people/72/\",\"2\":\"Lama Su\",\"3\":\"http://swapi.co/api/planets/10/\",\"4\":\"http://swapi.co/api/species/32/\"},{\"1\":\"http://swapi.co/api/people/73/\",\"2\":\"Taun We\",\"3\":\"http://swapi.co/api/planets/10/\",\"4\":\"http://swapi.co/api/species/32/\"},{\"1\":\"http://swapi.co/api/people/74/\",\"2\":\"Jocasta Nu\",\"3\":\"http://swapi.co/api/planets/9/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/47/\",\"2\":\"Ratts Tyerell\",\"3\":\"http://swapi.co/api/planets/38/\",\"4\":\"http://swapi.co/api/species/16/\"},{\"1\":\"http://swapi.co/api/people/75/\",\"2\":\"R4-P17\",\"3\":\"http://swapi.co/api/planets/28/\",\"4\":\"NA\"},{\"1\":\"http://swapi.co/api/people/76/\",\"2\":\"Wat Tambor\",\"3\":\"http://swapi.co/api/planets/56/\",\"4\":\"http://swapi.co/api/species/33/\"},{\"1\":\"http://swapi.co/api/people/77/\",\"2\":\"San Hill\",\"3\":\"http://swapi.co/api/planets/57/\",\"4\":\"http://swapi.co/api/species/34/\"},{\"1\":\"http://swapi.co/api/people/78/\",\"2\":\"Shaak Ti\",\"3\":\"http://swapi.co/api/planets/58/\",\"4\":\"http://swapi.co/api/species/35/\"},{\"1\":\"http://swapi.co/api/people/79/\",\"2\":\"Grievous\",\"3\":\"http://swapi.co/api/planets/59/\",\"4\":\"http://swapi.co/api/species/36/\"},{\"1\":\"http://swapi.co/api/people/80/\",\"2\":\"Tarfful\",\"3\":\"http://swapi.co/api/planets/14/\",\"4\":\"http://swapi.co/api/species/3/\"},{\"1\":\"http://swapi.co/api/people/81/\",\"2\":\"Raymus Antilles\",\"3\":\"http://swapi.co/api/planets/2/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/82/\",\"2\":\"Sly Moore\",\"3\":\"http://swapi.co/api/planets/60/\",\"4\":\"NA\"},{\"1\":\"http://swapi.co/api/people/83/\",\"2\":\"Tion Medon\",\"3\":\"http://swapi.co/api/planets/12/\",\"4\":\"http://swapi.co/api/species/37/\"},{\"1\":\"http://swapi.co/api/people/84/\",\"2\":\"Finn\",\"3\":\"http://swapi.co/api/planets/28/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/85/\",\"2\":\"Rey\",\"3\":\"http://swapi.co/api/planets/28/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/86/\",\"2\":\"Poe Dameron\",\"3\":\"http://swapi.co/api/planets/28/\",\"4\":\"http://swapi.co/api/species/1/\"},{\"1\":\"http://swapi.co/api/people/87/\",\"2\":\"BB8\",\"3\":\"http://swapi.co/api/planets/28/\",\"4\":\"http://swapi.co/api/species/2/\"},{\"1\":\"http://swapi.co/api/people/88/\",\"2\":\"Captain Phasma\",\"3\":\"http://swapi.co/api/planets/28/\",\"4\":\"NA\"},{\"1\":\"http://swapi.co/api/people/35/\",\"2\":\"Padmé Amidala\",\"3\":\"http://swapi.co/api/planets/8/\",\"4\":\"http://swapi.co/api/species/1/\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\nplanets\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"url\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"name\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"http://swapi.co/api/planets/2/\",\"2\":\"Alderaan\"},{\"1\":\"http://swapi.co/api/planets/3/\",\"2\":\"Yavin IV\"},{\"1\":\"http://swapi.co/api/planets/4/\",\"2\":\"Hoth\"},{\"1\":\"http://swapi.co/api/planets/5/\",\"2\":\"Dagobah\"},{\"1\":\"http://swapi.co/api/planets/6/\",\"2\":\"Bespin\"},{\"1\":\"http://swapi.co/api/planets/7/\",\"2\":\"Endor\"},{\"1\":\"http://swapi.co/api/planets/8/\",\"2\":\"Naboo\"},{\"1\":\"http://swapi.co/api/planets/9/\",\"2\":\"Coruscant\"},{\"1\":\"http://swapi.co/api/planets/10/\",\"2\":\"Kamino\"},{\"1\":\"http://swapi.co/api/planets/11/\",\"2\":\"Geonosis\"},{\"1\":\"http://swapi.co/api/planets/12/\",\"2\":\"Utapau\"},{\"1\":\"http://swapi.co/api/planets/13/\",\"2\":\"Mustafar\"},{\"1\":\"http://swapi.co/api/planets/14/\",\"2\":\"Kashyyyk\"},{\"1\":\"http://swapi.co/api/planets/15/\",\"2\":\"Polis Massa\"},{\"1\":\"http://swapi.co/api/planets/16/\",\"2\":\"Mygeeto\"},{\"1\":\"http://swapi.co/api/planets/17/\",\"2\":\"Felucia\"},{\"1\":\"http://swapi.co/api/planets/18/\",\"2\":\"Cato Neimoidia\"},{\"1\":\"http://swapi.co/api/planets/19/\",\"2\":\"Saleucami\"},{\"1\":\"http://swapi.co/api/planets/20/\",\"2\":\"Stewjon\"},{\"1\":\"http://swapi.co/api/planets/21/\",\"2\":\"Eriadu\"},{\"1\":\"http://swapi.co/api/planets/22/\",\"2\":\"Corellia\"},{\"1\":\"http://swapi.co/api/planets/23/\",\"2\":\"Rodia\"},{\"1\":\"http://swapi.co/api/planets/24/\",\"2\":\"Nal Hutta\"},{\"1\":\"http://swapi.co/api/planets/25/\",\"2\":\"Dantooine\"},{\"1\":\"http://swapi.co/api/planets/26/\",\"2\":\"Bestine IV\"},{\"1\":\"http://swapi.co/api/planets/27/\",\"2\":\"Ord Mantell\"},{\"1\":\"http://swapi.co/api/planets/28/\",\"2\":\"unknown\"},{\"1\":\"http://swapi.co/api/planets/29/\",\"2\":\"Trandosha\"},{\"1\":\"http://swapi.co/api/planets/30/\",\"2\":\"Socorro\"},{\"1\":\"http://swapi.co/api/planets/31/\",\"2\":\"Mon Cala\"},{\"1\":\"http://swapi.co/api/planets/32/\",\"2\":\"Chandrila\"},{\"1\":\"http://swapi.co/api/planets/33/\",\"2\":\"Sullust\"},{\"1\":\"http://swapi.co/api/planets/34/\",\"2\":\"Toydaria\"},{\"1\":\"http://swapi.co/api/planets/35/\",\"2\":\"Malastare\"},{\"1\":\"http://swapi.co/api/planets/36/\",\"2\":\"Dathomir\"},{\"1\":\"http://swapi.co/api/planets/37/\",\"2\":\"Ryloth\"},{\"1\":\"http://swapi.co/api/planets/38/\",\"2\":\"Aleen Minor\"},{\"1\":\"http://swapi.co/api/planets/39/\",\"2\":\"Vulpter\"},{\"1\":\"http://swapi.co/api/planets/40/\",\"2\":\"Troiken\"},{\"1\":\"http://swapi.co/api/planets/41/\",\"2\":\"Tund\"},{\"1\":\"http://swapi.co/api/planets/42/\",\"2\":\"Haruun Kal\"},{\"1\":\"http://swapi.co/api/planets/43/\",\"2\":\"Cerea\"},{\"1\":\"http://swapi.co/api/planets/44/\",\"2\":\"Glee Anselm\"},{\"1\":\"http://swapi.co/api/planets/45/\",\"2\":\"Iridonia\"},{\"1\":\"http://swapi.co/api/planets/46/\",\"2\":\"Tholoth\"},{\"1\":\"http://swapi.co/api/planets/47/\",\"2\":\"Iktotch\"},{\"1\":\"http://swapi.co/api/planets/48/\",\"2\":\"Quermia\"},{\"1\":\"http://swapi.co/api/planets/49/\",\"2\":\"Dorin\"},{\"1\":\"http://swapi.co/api/planets/50/\",\"2\":\"Champala\"},{\"1\":\"http://swapi.co/api/planets/51/\",\"2\":\"Mirial\"},{\"1\":\"http://swapi.co/api/planets/52/\",\"2\":\"Serenno\"},{\"1\":\"http://swapi.co/api/planets/53/\",\"2\":\"Concord Dawn\"},{\"1\":\"http://swapi.co/api/planets/54/\",\"2\":\"Zolan\"},{\"1\":\"http://swapi.co/api/planets/55/\",\"2\":\"Ojom\"},{\"1\":\"http://swapi.co/api/planets/56/\",\"2\":\"Skako\"},{\"1\":\"http://swapi.co/api/planets/57/\",\"2\":\"Muunilinst\"},{\"1\":\"http://swapi.co/api/planets/58/\",\"2\":\"Shili\"},{\"1\":\"http://swapi.co/api/planets/59/\",\"2\":\"Kalee\"},{\"1\":\"http://swapi.co/api/planets/60/\",\"2\":\"Umbara\"},{\"1\":\"http://swapi.co/api/planets/1/\",\"2\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/planets/61/\",\"2\":\"Jakku\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nChecking the prepared data frames, we can see that `url` column of each data frame is used as a key, so the relationship between the data frames can be summarized as shown in the following figure[^4].\n\n[^4]: Here, I used mermaid to illustrate the relationship between data frames.\n\nSince it is common for a film to have multiple characters, it is important to note that `characters` column of `films` is a list of characters, so it isn't possible to join `characters` column of `films` to `url` column of `people`.\n\n\n```{mermaid}\nflowchart TB\n  films.characters --> people.url\n  people.homeworld --> planets.url\n  subgraph films\n    films.url[url]\n    films.title[title]\n    films.characters[List of characters] \n  end\n  subgraph people\n    people.url[url]\n    people.name[name]\n    people.homeworld[homeworld]\n  end\n  subgraph planets\n    planets.url[url]\n    planets.name[name]\n  end\n```\n\n\nTherefore, we consider creating a new data file, `films_x_characters`, that represents the relationship between `films` and `people`, i.e., which characters appear in which films[^5]．Through `films_x_characters`, the relationship between data can be summarized as shown in the following figure.\n\n[^5]: There is no clear hierarchical relationship between works and characters, so the name `characters_x_films` is acceptable.\n\n\n```{mermaid}\nflowchart TB\n  films_x_characters.url --> films.url\n  films_x_characters.characters ---> people.url\n  people.homeworld --> planets.url\n  subgraph films_x_characters\n    films_x_characters.url[url]\n    films_x_characters.characters[characters]\n  end\n  subgraph films\n    films.url[url]\n    films.title[title]\n  end\n  subgraph people\n    people.url[url]\n    people.name[name]\n    people.homeworld[homeworld]\n  end\n  subgraph planets\n    planets.url[url]\n    planets.name[name]\n  end\n```\n\n\nNow, let's build a relational data model according to the above image. First, create `films_x_characters` using `url` and `characters` columns of `films`. In addition, I delete the unnecessary `characters` column from `films`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create films_x_characters and remove characters column from films\nfilms_x_characters <- films |> \n  select(url, characters) |> \n  unnest_longer(characters)\nfilms <- films |> \n  select(!characters)\n\nfilms_x_characters\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"url\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"characters\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/1/\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/2/\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/3/\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/4/\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/5/\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/6/\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/7/\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/8/\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/9/\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/10/\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/12/\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/13/\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/14/\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/15/\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/16/\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/18/\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/19/\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/81/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/2/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/3/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/6/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/7/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/10/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/11/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/20/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/21/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/22/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/33/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/36/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/40/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/43/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/46/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/51/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/52/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/53/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/58/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/59/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/60/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/61/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/62/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/63/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/64/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/65/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/66/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/67/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/68/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/69/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/70/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/71/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/72/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/73/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/74/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/75/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/76/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/77/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/78/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/82/\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/35/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/2/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/3/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/10/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/11/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/16/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/20/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/21/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/32/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/33/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/34/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/36/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/37/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/38/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/39/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/40/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/41/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/42/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/43/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/44/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/46/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/48/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/49/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/50/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/51/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/52/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/53/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/54/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/55/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/56/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/57/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/58/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/59/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/47/\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/35/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/1/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/2/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/3/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/4/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/5/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/6/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/7/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/10/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/11/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/12/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/13/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/20/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/21/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/33/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/46/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/51/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/52/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/53/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/54/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/55/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/56/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/58/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/63/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/64/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/67/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/68/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/75/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/78/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/79/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/80/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/81/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/82/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/83/\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/35/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/1/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/2/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/3/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/4/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/5/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/10/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/13/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/14/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/16/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/18/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/20/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/21/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/22/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/25/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/27/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/28/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/29/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/30/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/31/\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/45/\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/1/\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/2/\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/3/\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/4/\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/5/\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/10/\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/13/\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/14/\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/18/\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/20/\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/21/\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/22/\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/23/\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/24/\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/25/\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/26/\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/1/\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/3/\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/5/\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/13/\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/14/\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/27/\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/84/\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/85/\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/86/\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/87/\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/88/\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nFinally, after passing the prepared `films`, `people`, `planets`, and `films_x_characters` to `dm()`, a relational data model can be built by adding primary keys and foreign keys.\n\nIn dm, primary keys are set with `dm_add_pk()`[^6] and foreign keys with `dm_add_fk()`[^7].\n\n[^6]: For `films`, `people`, and `planets`, the `url` column is the primary key, and for `films_x_characters`, `url` and `characters` are the primary keys.\n\n[^7]: Following the arrows in the image above, I set foreign keys.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndm_starwars_1 <- dm(films, people, planets, films_x_characters) |> \n  \n  # 1. Add primary keys\n  dm_add_pk(films, url) |>\n  dm_add_pk(people, url) |>\n  dm_add_pk(planets, url) |>\n  dm_add_pk(films_x_characters, c(url, characters)) |>\n  \n  # 2. Add foreign keys\n  dm_add_fk(films_x_characters, url, films) |> \n  dm_add_fk(films_x_characters, characters, people) |>\n  dm_add_fk(people, homeworld, planets) \n\ndm_starwars_1\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n── Metadata ────────────────────────────────────────────────────────────────────\nTables: `films`, `people`, `planets`, `films_x_characters`\nColumns: 10\nPrimary keys: 4\nForeign keys: 3\n```\n\n\n:::\n:::\n\n\nThe relational data model can be drawn using `dm_draw()`. The drawing reveals that the same relationships are built as in the image above.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndm_draw(dm_starwars_1)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"grViz html-widget html-fill-item\" id=\"htmlwidget-8d508afbb5911858ec56\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-8d508afbb5911858ec56\">{\"x\":{\"diagram\":\"#data_model\\ndigraph {\\ngraph [rankdir=LR tooltip=\\\"Data Model\\\" ]\\n\\nnode [margin=0 fontcolor = \\\"#444444\\\" ]\\n\\nedge [color = \\\"#555555\\\", arrowsize = 1, ]\\n\\npack=true\\npackmode= \\\"node\\\"\\n\\n  \\\"films\\\" [id = \\\"films\\\", label = <<TABLE ALIGN=\\\"LEFT\\\" BORDER=\\\"1\\\" CELLBORDER=\\\"0\\\" CELLSPACING=\\\"0\\\" COLOR=\\\"#555555\\\">\\n    <TR>\\n      <TD COLSPAN=\\\"1\\\" BGCOLOR=\\\"#EFEBDD\\\" BORDER=\\\"0\\\"><FONT COLOR=\\\"#000000\\\">films<\\/FONT>\\n<\\/TD>\\n    <\\/TR>\\n    <TR>\\n      <TD ALIGN=\\\"LEFT\\\" BGCOLOR=\\\"#FFFFFF\\\" PORT=\\\"url\\\"><U>url<\\/U><\\/TD>\\n    <\\/TR>\\n  <\\/TABLE>>, shape = \\\"plaintext\\\"] \\n\\n  \\\"films_x_characters\\\" [id = \\\"films_x_characters\\\", label = <<TABLE ALIGN=\\\"LEFT\\\" BORDER=\\\"1\\\" CELLBORDER=\\\"0\\\" CELLSPACING=\\\"0\\\" COLOR=\\\"#555555\\\">\\n    <TR>\\n      <TD COLSPAN=\\\"1\\\" BGCOLOR=\\\"#EFEBDD\\\" BORDER=\\\"0\\\"><FONT COLOR=\\\"#000000\\\">films_x_characters<\\/FONT>\\n<\\/TD>\\n    <\\/TR>\\n    <TR>\\n      <TD ALIGN=\\\"LEFT\\\" BGCOLOR=\\\"#FFFFFF\\\" PORT=\\\"url\\\">url<\\/TD>\\n    <\\/TR>\\n    <TR>\\n      <TD ALIGN=\\\"LEFT\\\" BGCOLOR=\\\"#FFFFFF\\\" PORT=\\\"characters\\\">characters<\\/TD>\\n    <\\/TR>\\n    <TR>\\n      <TD ALIGN=\\\"LEFT\\\" BGCOLOR=\\\"#FFFFFF\\\" PORT=\\\"url, characters\\\"><U>url, characters<\\/U><\\/TD>\\n    <\\/TR>\\n  <\\/TABLE>>, shape = \\\"plaintext\\\"] \\n\\n  \\\"people\\\" [id = \\\"people\\\", label = <<TABLE ALIGN=\\\"LEFT\\\" BORDER=\\\"1\\\" CELLBORDER=\\\"0\\\" CELLSPACING=\\\"0\\\" COLOR=\\\"#555555\\\">\\n    <TR>\\n      <TD COLSPAN=\\\"1\\\" BGCOLOR=\\\"#EFEBDD\\\" BORDER=\\\"0\\\"><FONT COLOR=\\\"#000000\\\">people<\\/FONT>\\n<\\/TD>\\n    <\\/TR>\\n    <TR>\\n      <TD ALIGN=\\\"LEFT\\\" BGCOLOR=\\\"#FFFFFF\\\" PORT=\\\"url\\\"><U>url<\\/U><\\/TD>\\n    <\\/TR>\\n    <TR>\\n      <TD ALIGN=\\\"LEFT\\\" BGCOLOR=\\\"#FFFFFF\\\" PORT=\\\"homeworld\\\">homeworld<\\/TD>\\n    <\\/TR>\\n  <\\/TABLE>>, shape = \\\"plaintext\\\"] \\n\\n  \\\"planets\\\" [id = \\\"planets\\\", label = <<TABLE ALIGN=\\\"LEFT\\\" BORDER=\\\"1\\\" CELLBORDER=\\\"0\\\" CELLSPACING=\\\"0\\\" COLOR=\\\"#555555\\\">\\n    <TR>\\n      <TD COLSPAN=\\\"1\\\" BGCOLOR=\\\"#EFEBDD\\\" BORDER=\\\"0\\\"><FONT COLOR=\\\"#000000\\\">planets<\\/FONT>\\n<\\/TD>\\n    <\\/TR>\\n    <TR>\\n      <TD ALIGN=\\\"LEFT\\\" BGCOLOR=\\\"#FFFFFF\\\" PORT=\\\"url\\\"><U>url<\\/U><\\/TD>\\n    <\\/TR>\\n  <\\/TABLE>>, shape = \\\"plaintext\\\"] \\n\\n\\\"films_x_characters\\\":\\\"url\\\"->\\\"films\\\":\\\"url\\\" [id=\\\"films_x_characters_1\\\"]\\n\\\"films_x_characters\\\":\\\"characters\\\"->\\\"people\\\":\\\"url\\\" [id=\\\"films_x_characters_2\\\"]\\n\\\"people\\\":\\\"homeworld\\\"->\\\"planets\\\":\\\"url\\\" [id=\\\"people_1\\\"]\\n}\",\"config\":{\"engine\":null,\"options\":null}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\nBy using `dm_flatten_to_tbl()` as shown below, a data frame can be created by joining `films_x_characters` data with `films`/`people`/`planets` data. In this case, if the same column names exist between different data, the column names are automatically renamed according to the data names. In this way, the relational data model manages the relationships between data on our behalf, allowing us to automatically join data frames based on the relationships among other data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_films_x_characters_1 <- dm_starwars_1 |> \n  dm_flatten_to_tbl(films_x_characters,\n                    .recursive = TRUE) \n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRenaming ambiguous columns: %>%\n  dm_rename(people, name.people = name) %>%\n  dm_rename(planets, name.planets = name)\n```\n\n\n:::\n\n```{.r .cell-code}\ndata_films_x_characters_1\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"url\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"characters\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"title\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"name.people\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"homeworld\"],\"name\":[5],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"species\"],\"name\":[6],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"name.planets\"],\"name\":[7],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/1/\",\"3\":\"A New Hope\",\"4\":\"Luke Skywalker\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/2/\",\"3\":\"A New Hope\",\"4\":\"C-3PO\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/2/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/3/\",\"3\":\"A New Hope\",\"4\":\"R2-D2\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/2/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/4/\",\"3\":\"A New Hope\",\"4\":\"Darth Vader\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/5/\",\"3\":\"A New Hope\",\"4\":\"Leia Organa\",\"5\":\"http://swapi.co/api/planets/2/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Alderaan\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/6/\",\"3\":\"A New Hope\",\"4\":\"Owen Lars\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/7/\",\"3\":\"A New Hope\",\"4\":\"Beru Whitesun lars\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/8/\",\"3\":\"A New Hope\",\"4\":\"R5-D4\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/2/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/9/\",\"3\":\"A New Hope\",\"4\":\"Biggs Darklighter\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/10/\",\"3\":\"A New Hope\",\"4\":\"Obi-Wan Kenobi\",\"5\":\"http://swapi.co/api/planets/20/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Stewjon\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/12/\",\"3\":\"A New Hope\",\"4\":\"Wilhuff Tarkin\",\"5\":\"http://swapi.co/api/planets/21/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Eriadu\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/13/\",\"3\":\"A New Hope\",\"4\":\"Chewbacca\",\"5\":\"http://swapi.co/api/planets/14/\",\"6\":\"http://swapi.co/api/species/3/\",\"7\":\"Kashyyyk\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/14/\",\"3\":\"A New Hope\",\"4\":\"Han Solo\",\"5\":\"http://swapi.co/api/planets/22/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Corellia\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/15/\",\"3\":\"A New Hope\",\"4\":\"Greedo\",\"5\":\"http://swapi.co/api/planets/23/\",\"6\":\"http://swapi.co/api/species/4/\",\"7\":\"Rodia\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/16/\",\"3\":\"A New Hope\",\"4\":\"Jabba Desilijic Tiure\",\"5\":\"http://swapi.co/api/planets/24/\",\"6\":\"http://swapi.co/api/species/5/\",\"7\":\"Nal Hutta\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/18/\",\"3\":\"A New Hope\",\"4\":\"Wedge Antilles\",\"5\":\"http://swapi.co/api/planets/22/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Corellia\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/19/\",\"3\":\"A New Hope\",\"4\":\"Jek Tono Porkins\",\"5\":\"http://swapi.co/api/planets/26/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Bestine IV\"},{\"1\":\"http://swapi.co/api/films/1/\",\"2\":\"http://swapi.co/api/people/81/\",\"3\":\"A New Hope\",\"4\":\"Raymus Antilles\",\"5\":\"http://swapi.co/api/planets/2/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Alderaan\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/2/\",\"3\":\"Attack of the Clones\",\"4\":\"C-3PO\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/2/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/3/\",\"3\":\"Attack of the Clones\",\"4\":\"R2-D2\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/2/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/6/\",\"3\":\"Attack of the Clones\",\"4\":\"Owen Lars\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/7/\",\"3\":\"Attack of the Clones\",\"4\":\"Beru Whitesun lars\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/10/\",\"3\":\"Attack of the Clones\",\"4\":\"Obi-Wan Kenobi\",\"5\":\"http://swapi.co/api/planets/20/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Stewjon\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/11/\",\"3\":\"Attack of the Clones\",\"4\":\"Anakin Skywalker\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/20/\",\"3\":\"Attack of the Clones\",\"4\":\"Yoda\",\"5\":\"http://swapi.co/api/planets/28/\",\"6\":\"http://swapi.co/api/species/6/\",\"7\":\"unknown\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/21/\",\"3\":\"Attack of the Clones\",\"4\":\"Palpatine\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/22/\",\"3\":\"Attack of the Clones\",\"4\":\"Boba Fett\",\"5\":\"http://swapi.co/api/planets/10/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Kamino\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/33/\",\"3\":\"Attack of the Clones\",\"4\":\"Nute Gunray\",\"5\":\"http://swapi.co/api/planets/18/\",\"6\":\"http://swapi.co/api/species/11/\",\"7\":\"Cato Neimoidia\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/36/\",\"3\":\"Attack of the Clones\",\"4\":\"Jar Jar Binks\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/12/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/40/\",\"3\":\"Attack of the Clones\",\"4\":\"Watto\",\"5\":\"http://swapi.co/api/planets/34/\",\"6\":\"http://swapi.co/api/species/13/\",\"7\":\"Toydaria\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/43/\",\"3\":\"Attack of the Clones\",\"4\":\"Shmi Skywalker\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/46/\",\"3\":\"Attack of the Clones\",\"4\":\"Ayla Secura\",\"5\":\"http://swapi.co/api/planets/37/\",\"6\":\"http://swapi.co/api/species/15/\",\"7\":\"Ryloth\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/51/\",\"3\":\"Attack of the Clones\",\"4\":\"Mace Windu\",\"5\":\"http://swapi.co/api/planets/42/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Haruun Kal\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/52/\",\"3\":\"Attack of the Clones\",\"4\":\"Ki-Adi-Mundi\",\"5\":\"http://swapi.co/api/planets/43/\",\"6\":\"http://swapi.co/api/species/20/\",\"7\":\"Cerea\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/53/\",\"3\":\"Attack of the Clones\",\"4\":\"Kit Fisto\",\"5\":\"http://swapi.co/api/planets/44/\",\"6\":\"http://swapi.co/api/species/21/\",\"7\":\"Glee Anselm\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/58/\",\"3\":\"Attack of the Clones\",\"4\":\"Plo Koon\",\"5\":\"http://swapi.co/api/planets/49/\",\"6\":\"http://swapi.co/api/species/26/\",\"7\":\"Dorin\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/59/\",\"3\":\"Attack of the Clones\",\"4\":\"Mas Amedda\",\"5\":\"http://swapi.co/api/planets/50/\",\"6\":\"http://swapi.co/api/species/27/\",\"7\":\"Champala\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/60/\",\"3\":\"Attack of the Clones\",\"4\":\"Gregar Typho\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/61/\",\"3\":\"Attack of the Clones\",\"4\":\"Cordé\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/62/\",\"3\":\"Attack of the Clones\",\"4\":\"Cliegg Lars\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/63/\",\"3\":\"Attack of the Clones\",\"4\":\"Poggle the Lesser\",\"5\":\"http://swapi.co/api/planets/11/\",\"6\":\"http://swapi.co/api/species/28/\",\"7\":\"Geonosis\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/64/\",\"3\":\"Attack of the Clones\",\"4\":\"Luminara Unduli\",\"5\":\"http://swapi.co/api/planets/51/\",\"6\":\"http://swapi.co/api/species/29/\",\"7\":\"Mirial\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/65/\",\"3\":\"Attack of the Clones\",\"4\":\"Barriss Offee\",\"5\":\"http://swapi.co/api/planets/51/\",\"6\":\"http://swapi.co/api/species/29/\",\"7\":\"Mirial\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/66/\",\"3\":\"Attack of the Clones\",\"4\":\"Dormé\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/67/\",\"3\":\"Attack of the Clones\",\"4\":\"Dooku\",\"5\":\"http://swapi.co/api/planets/52/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Serenno\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/68/\",\"3\":\"Attack of the Clones\",\"4\":\"Bail Prestor Organa\",\"5\":\"http://swapi.co/api/planets/2/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Alderaan\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/69/\",\"3\":\"Attack of the Clones\",\"4\":\"Jango Fett\",\"5\":\"http://swapi.co/api/planets/53/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Concord Dawn\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/70/\",\"3\":\"Attack of the Clones\",\"4\":\"Zam Wesell\",\"5\":\"http://swapi.co/api/planets/54/\",\"6\":\"http://swapi.co/api/species/30/\",\"7\":\"Zolan\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/71/\",\"3\":\"Attack of the Clones\",\"4\":\"Dexter Jettster\",\"5\":\"http://swapi.co/api/planets/55/\",\"6\":\"http://swapi.co/api/species/31/\",\"7\":\"Ojom\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/72/\",\"3\":\"Attack of the Clones\",\"4\":\"Lama Su\",\"5\":\"http://swapi.co/api/planets/10/\",\"6\":\"http://swapi.co/api/species/32/\",\"7\":\"Kamino\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/73/\",\"3\":\"Attack of the Clones\",\"4\":\"Taun We\",\"5\":\"http://swapi.co/api/planets/10/\",\"6\":\"http://swapi.co/api/species/32/\",\"7\":\"Kamino\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/74/\",\"3\":\"Attack of the Clones\",\"4\":\"Jocasta Nu\",\"5\":\"http://swapi.co/api/planets/9/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Coruscant\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/75/\",\"3\":\"Attack of the Clones\",\"4\":\"R4-P17\",\"5\":\"http://swapi.co/api/planets/28/\",\"6\":\"NA\",\"7\":\"unknown\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/76/\",\"3\":\"Attack of the Clones\",\"4\":\"Wat Tambor\",\"5\":\"http://swapi.co/api/planets/56/\",\"6\":\"http://swapi.co/api/species/33/\",\"7\":\"Skako\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/77/\",\"3\":\"Attack of the Clones\",\"4\":\"San Hill\",\"5\":\"http://swapi.co/api/planets/57/\",\"6\":\"http://swapi.co/api/species/34/\",\"7\":\"Muunilinst\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/78/\",\"3\":\"Attack of the Clones\",\"4\":\"Shaak Ti\",\"5\":\"http://swapi.co/api/planets/58/\",\"6\":\"http://swapi.co/api/species/35/\",\"7\":\"Shili\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/82/\",\"3\":\"Attack of the Clones\",\"4\":\"Sly Moore\",\"5\":\"http://swapi.co/api/planets/60/\",\"6\":\"NA\",\"7\":\"Umbara\"},{\"1\":\"http://swapi.co/api/films/5/\",\"2\":\"http://swapi.co/api/people/35/\",\"3\":\"Attack of the Clones\",\"4\":\"Padmé Amidala\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/2/\",\"3\":\"The Phantom Menace\",\"4\":\"C-3PO\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/2/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/3/\",\"3\":\"The Phantom Menace\",\"4\":\"R2-D2\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/2/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/10/\",\"3\":\"The Phantom Menace\",\"4\":\"Obi-Wan Kenobi\",\"5\":\"http://swapi.co/api/planets/20/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Stewjon\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/11/\",\"3\":\"The Phantom Menace\",\"4\":\"Anakin Skywalker\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/16/\",\"3\":\"The Phantom Menace\",\"4\":\"Jabba Desilijic Tiure\",\"5\":\"http://swapi.co/api/planets/24/\",\"6\":\"http://swapi.co/api/species/5/\",\"7\":\"Nal Hutta\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/20/\",\"3\":\"The Phantom Menace\",\"4\":\"Yoda\",\"5\":\"http://swapi.co/api/planets/28/\",\"6\":\"http://swapi.co/api/species/6/\",\"7\":\"unknown\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/21/\",\"3\":\"The Phantom Menace\",\"4\":\"Palpatine\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/32/\",\"3\":\"The Phantom Menace\",\"4\":\"Qui-Gon Jinn\",\"5\":\"http://swapi.co/api/planets/28/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"unknown\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/33/\",\"3\":\"The Phantom Menace\",\"4\":\"Nute Gunray\",\"5\":\"http://swapi.co/api/planets/18/\",\"6\":\"http://swapi.co/api/species/11/\",\"7\":\"Cato Neimoidia\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/34/\",\"3\":\"The Phantom Menace\",\"4\":\"Finis Valorum\",\"5\":\"http://swapi.co/api/planets/9/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Coruscant\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/36/\",\"3\":\"The Phantom Menace\",\"4\":\"Jar Jar Binks\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/12/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/37/\",\"3\":\"The Phantom Menace\",\"4\":\"Roos Tarpals\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/12/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/38/\",\"3\":\"The Phantom Menace\",\"4\":\"Rugor Nass\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/12/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/39/\",\"3\":\"The Phantom Menace\",\"4\":\"Ric Olié\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"NA\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/40/\",\"3\":\"The Phantom Menace\",\"4\":\"Watto\",\"5\":\"http://swapi.co/api/planets/34/\",\"6\":\"http://swapi.co/api/species/13/\",\"7\":\"Toydaria\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/41/\",\"3\":\"The Phantom Menace\",\"4\":\"Sebulba\",\"5\":\"http://swapi.co/api/planets/35/\",\"6\":\"http://swapi.co/api/species/14/\",\"7\":\"Malastare\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/42/\",\"3\":\"The Phantom Menace\",\"4\":\"Quarsh Panaka\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"NA\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/43/\",\"3\":\"The Phantom Menace\",\"4\":\"Shmi Skywalker\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/44/\",\"3\":\"The Phantom Menace\",\"4\":\"Darth Maul\",\"5\":\"http://swapi.co/api/planets/36/\",\"6\":\"http://swapi.co/api/species/22/\",\"7\":\"Dathomir\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/46/\",\"3\":\"The Phantom Menace\",\"4\":\"Ayla Secura\",\"5\":\"http://swapi.co/api/planets/37/\",\"6\":\"http://swapi.co/api/species/15/\",\"7\":\"Ryloth\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/48/\",\"3\":\"The Phantom Menace\",\"4\":\"Dud Bolt\",\"5\":\"http://swapi.co/api/planets/39/\",\"6\":\"http://swapi.co/api/species/17/\",\"7\":\"Vulpter\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/49/\",\"3\":\"The Phantom Menace\",\"4\":\"Gasgano\",\"5\":\"http://swapi.co/api/planets/40/\",\"6\":\"http://swapi.co/api/species/18/\",\"7\":\"Troiken\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/50/\",\"3\":\"The Phantom Menace\",\"4\":\"Ben Quadinaros\",\"5\":\"http://swapi.co/api/planets/41/\",\"6\":\"http://swapi.co/api/species/19/\",\"7\":\"Tund\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/51/\",\"3\":\"The Phantom Menace\",\"4\":\"Mace Windu\",\"5\":\"http://swapi.co/api/planets/42/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Haruun Kal\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/52/\",\"3\":\"The Phantom Menace\",\"4\":\"Ki-Adi-Mundi\",\"5\":\"http://swapi.co/api/planets/43/\",\"6\":\"http://swapi.co/api/species/20/\",\"7\":\"Cerea\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/53/\",\"3\":\"The Phantom Menace\",\"4\":\"Kit Fisto\",\"5\":\"http://swapi.co/api/planets/44/\",\"6\":\"http://swapi.co/api/species/21/\",\"7\":\"Glee Anselm\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/54/\",\"3\":\"The Phantom Menace\",\"4\":\"Eeth Koth\",\"5\":\"http://swapi.co/api/planets/45/\",\"6\":\"http://swapi.co/api/species/22/\",\"7\":\"Iridonia\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/55/\",\"3\":\"The Phantom Menace\",\"4\":\"Adi Gallia\",\"5\":\"http://swapi.co/api/planets/9/\",\"6\":\"http://swapi.co/api/species/23/\",\"7\":\"Coruscant\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/56/\",\"3\":\"The Phantom Menace\",\"4\":\"Saesee Tiin\",\"5\":\"http://swapi.co/api/planets/47/\",\"6\":\"http://swapi.co/api/species/24/\",\"7\":\"Iktotch\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/57/\",\"3\":\"The Phantom Menace\",\"4\":\"Yarael Poof\",\"5\":\"http://swapi.co/api/planets/48/\",\"6\":\"http://swapi.co/api/species/25/\",\"7\":\"Quermia\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/58/\",\"3\":\"The Phantom Menace\",\"4\":\"Plo Koon\",\"5\":\"http://swapi.co/api/planets/49/\",\"6\":\"http://swapi.co/api/species/26/\",\"7\":\"Dorin\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/59/\",\"3\":\"The Phantom Menace\",\"4\":\"Mas Amedda\",\"5\":\"http://swapi.co/api/planets/50/\",\"6\":\"http://swapi.co/api/species/27/\",\"7\":\"Champala\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/47/\",\"3\":\"The Phantom Menace\",\"4\":\"Ratts Tyerell\",\"5\":\"http://swapi.co/api/planets/38/\",\"6\":\"http://swapi.co/api/species/16/\",\"7\":\"Aleen Minor\"},{\"1\":\"http://swapi.co/api/films/4/\",\"2\":\"http://swapi.co/api/people/35/\",\"3\":\"The Phantom Menace\",\"4\":\"Padmé Amidala\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/1/\",\"3\":\"Revenge of the Sith\",\"4\":\"Luke Skywalker\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/2/\",\"3\":\"Revenge of the Sith\",\"4\":\"C-3PO\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/2/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/3/\",\"3\":\"Revenge of the Sith\",\"4\":\"R2-D2\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/2/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/4/\",\"3\":\"Revenge of the Sith\",\"4\":\"Darth Vader\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/5/\",\"3\":\"Revenge of the Sith\",\"4\":\"Leia Organa\",\"5\":\"http://swapi.co/api/planets/2/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Alderaan\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/6/\",\"3\":\"Revenge of the Sith\",\"4\":\"Owen Lars\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/7/\",\"3\":\"Revenge of the Sith\",\"4\":\"Beru Whitesun lars\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/10/\",\"3\":\"Revenge of the Sith\",\"4\":\"Obi-Wan Kenobi\",\"5\":\"http://swapi.co/api/planets/20/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Stewjon\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/11/\",\"3\":\"Revenge of the Sith\",\"4\":\"Anakin Skywalker\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/12/\",\"3\":\"Revenge of the Sith\",\"4\":\"Wilhuff Tarkin\",\"5\":\"http://swapi.co/api/planets/21/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Eriadu\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/13/\",\"3\":\"Revenge of the Sith\",\"4\":\"Chewbacca\",\"5\":\"http://swapi.co/api/planets/14/\",\"6\":\"http://swapi.co/api/species/3/\",\"7\":\"Kashyyyk\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/20/\",\"3\":\"Revenge of the Sith\",\"4\":\"Yoda\",\"5\":\"http://swapi.co/api/planets/28/\",\"6\":\"http://swapi.co/api/species/6/\",\"7\":\"unknown\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/21/\",\"3\":\"Revenge of the Sith\",\"4\":\"Palpatine\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/33/\",\"3\":\"Revenge of the Sith\",\"4\":\"Nute Gunray\",\"5\":\"http://swapi.co/api/planets/18/\",\"6\":\"http://swapi.co/api/species/11/\",\"7\":\"Cato Neimoidia\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/46/\",\"3\":\"Revenge of the Sith\",\"4\":\"Ayla Secura\",\"5\":\"http://swapi.co/api/planets/37/\",\"6\":\"http://swapi.co/api/species/15/\",\"7\":\"Ryloth\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/51/\",\"3\":\"Revenge of the Sith\",\"4\":\"Mace Windu\",\"5\":\"http://swapi.co/api/planets/42/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Haruun Kal\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/52/\",\"3\":\"Revenge of the Sith\",\"4\":\"Ki-Adi-Mundi\",\"5\":\"http://swapi.co/api/planets/43/\",\"6\":\"http://swapi.co/api/species/20/\",\"7\":\"Cerea\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/53/\",\"3\":\"Revenge of the Sith\",\"4\":\"Kit Fisto\",\"5\":\"http://swapi.co/api/planets/44/\",\"6\":\"http://swapi.co/api/species/21/\",\"7\":\"Glee Anselm\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/54/\",\"3\":\"Revenge of the Sith\",\"4\":\"Eeth Koth\",\"5\":\"http://swapi.co/api/planets/45/\",\"6\":\"http://swapi.co/api/species/22/\",\"7\":\"Iridonia\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/55/\",\"3\":\"Revenge of the Sith\",\"4\":\"Adi Gallia\",\"5\":\"http://swapi.co/api/planets/9/\",\"6\":\"http://swapi.co/api/species/23/\",\"7\":\"Coruscant\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/56/\",\"3\":\"Revenge of the Sith\",\"4\":\"Saesee Tiin\",\"5\":\"http://swapi.co/api/planets/47/\",\"6\":\"http://swapi.co/api/species/24/\",\"7\":\"Iktotch\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/58/\",\"3\":\"Revenge of the Sith\",\"4\":\"Plo Koon\",\"5\":\"http://swapi.co/api/planets/49/\",\"6\":\"http://swapi.co/api/species/26/\",\"7\":\"Dorin\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/63/\",\"3\":\"Revenge of the Sith\",\"4\":\"Poggle the Lesser\",\"5\":\"http://swapi.co/api/planets/11/\",\"6\":\"http://swapi.co/api/species/28/\",\"7\":\"Geonosis\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/64/\",\"3\":\"Revenge of the Sith\",\"4\":\"Luminara Unduli\",\"5\":\"http://swapi.co/api/planets/51/\",\"6\":\"http://swapi.co/api/species/29/\",\"7\":\"Mirial\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/67/\",\"3\":\"Revenge of the Sith\",\"4\":\"Dooku\",\"5\":\"http://swapi.co/api/planets/52/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Serenno\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/68/\",\"3\":\"Revenge of the Sith\",\"4\":\"Bail Prestor Organa\",\"5\":\"http://swapi.co/api/planets/2/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Alderaan\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/75/\",\"3\":\"Revenge of the Sith\",\"4\":\"R4-P17\",\"5\":\"http://swapi.co/api/planets/28/\",\"6\":\"NA\",\"7\":\"unknown\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/78/\",\"3\":\"Revenge of the Sith\",\"4\":\"Shaak Ti\",\"5\":\"http://swapi.co/api/planets/58/\",\"6\":\"http://swapi.co/api/species/35/\",\"7\":\"Shili\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/79/\",\"3\":\"Revenge of the Sith\",\"4\":\"Grievous\",\"5\":\"http://swapi.co/api/planets/59/\",\"6\":\"http://swapi.co/api/species/36/\",\"7\":\"Kalee\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/80/\",\"3\":\"Revenge of the Sith\",\"4\":\"Tarfful\",\"5\":\"http://swapi.co/api/planets/14/\",\"6\":\"http://swapi.co/api/species/3/\",\"7\":\"Kashyyyk\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/81/\",\"3\":\"Revenge of the Sith\",\"4\":\"Raymus Antilles\",\"5\":\"http://swapi.co/api/planets/2/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Alderaan\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/82/\",\"3\":\"Revenge of the Sith\",\"4\":\"Sly Moore\",\"5\":\"http://swapi.co/api/planets/60/\",\"6\":\"NA\",\"7\":\"Umbara\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/83/\",\"3\":\"Revenge of the Sith\",\"4\":\"Tion Medon\",\"5\":\"http://swapi.co/api/planets/12/\",\"6\":\"http://swapi.co/api/species/37/\",\"7\":\"Utapau\"},{\"1\":\"http://swapi.co/api/films/6/\",\"2\":\"http://swapi.co/api/people/35/\",\"3\":\"Revenge of the Sith\",\"4\":\"Padmé Amidala\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/1/\",\"3\":\"Return of the Jedi\",\"4\":\"Luke Skywalker\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/2/\",\"3\":\"Return of the Jedi\",\"4\":\"C-3PO\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/2/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/3/\",\"3\":\"Return of the Jedi\",\"4\":\"R2-D2\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/2/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/4/\",\"3\":\"Return of the Jedi\",\"4\":\"Darth Vader\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/5/\",\"3\":\"Return of the Jedi\",\"4\":\"Leia Organa\",\"5\":\"http://swapi.co/api/planets/2/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Alderaan\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/10/\",\"3\":\"Return of the Jedi\",\"4\":\"Obi-Wan Kenobi\",\"5\":\"http://swapi.co/api/planets/20/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Stewjon\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/13/\",\"3\":\"Return of the Jedi\",\"4\":\"Chewbacca\",\"5\":\"http://swapi.co/api/planets/14/\",\"6\":\"http://swapi.co/api/species/3/\",\"7\":\"Kashyyyk\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/14/\",\"3\":\"Return of the Jedi\",\"4\":\"Han Solo\",\"5\":\"http://swapi.co/api/planets/22/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Corellia\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/16/\",\"3\":\"Return of the Jedi\",\"4\":\"Jabba Desilijic Tiure\",\"5\":\"http://swapi.co/api/planets/24/\",\"6\":\"http://swapi.co/api/species/5/\",\"7\":\"Nal Hutta\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/18/\",\"3\":\"Return of the Jedi\",\"4\":\"Wedge Antilles\",\"5\":\"http://swapi.co/api/planets/22/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Corellia\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/20/\",\"3\":\"Return of the Jedi\",\"4\":\"Yoda\",\"5\":\"http://swapi.co/api/planets/28/\",\"6\":\"http://swapi.co/api/species/6/\",\"7\":\"unknown\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/21/\",\"3\":\"Return of the Jedi\",\"4\":\"Palpatine\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/22/\",\"3\":\"Return of the Jedi\",\"4\":\"Boba Fett\",\"5\":\"http://swapi.co/api/planets/10/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Kamino\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/25/\",\"3\":\"Return of the Jedi\",\"4\":\"Lando Calrissian\",\"5\":\"http://swapi.co/api/planets/30/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Socorro\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/27/\",\"3\":\"Return of the Jedi\",\"4\":\"Ackbar\",\"5\":\"http://swapi.co/api/planets/31/\",\"6\":\"http://swapi.co/api/species/8/\",\"7\":\"Mon Cala\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/28/\",\"3\":\"Return of the Jedi\",\"4\":\"Mon Mothma\",\"5\":\"http://swapi.co/api/planets/32/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Chandrila\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/29/\",\"3\":\"Return of the Jedi\",\"4\":\"Arvel Crynyd\",\"5\":\"http://swapi.co/api/planets/28/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"unknown\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/30/\",\"3\":\"Return of the Jedi\",\"4\":\"Wicket Systri Warrick\",\"5\":\"http://swapi.co/api/planets/7/\",\"6\":\"http://swapi.co/api/species/9/\",\"7\":\"Endor\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/31/\",\"3\":\"Return of the Jedi\",\"4\":\"Nien Nunb\",\"5\":\"http://swapi.co/api/planets/33/\",\"6\":\"http://swapi.co/api/species/10/\",\"7\":\"Sullust\"},{\"1\":\"http://swapi.co/api/films/3/\",\"2\":\"http://swapi.co/api/people/45/\",\"3\":\"Return of the Jedi\",\"4\":\"Bib Fortuna\",\"5\":\"http://swapi.co/api/planets/37/\",\"6\":\"http://swapi.co/api/species/15/\",\"7\":\"Ryloth\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/1/\",\"3\":\"The Empire Strikes Back\",\"4\":\"Luke Skywalker\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/2/\",\"3\":\"The Empire Strikes Back\",\"4\":\"C-3PO\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/2/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/3/\",\"3\":\"The Empire Strikes Back\",\"4\":\"R2-D2\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/2/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/4/\",\"3\":\"The Empire Strikes Back\",\"4\":\"Darth Vader\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/5/\",\"3\":\"The Empire Strikes Back\",\"4\":\"Leia Organa\",\"5\":\"http://swapi.co/api/planets/2/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Alderaan\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/10/\",\"3\":\"The Empire Strikes Back\",\"4\":\"Obi-Wan Kenobi\",\"5\":\"http://swapi.co/api/planets/20/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Stewjon\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/13/\",\"3\":\"The Empire Strikes Back\",\"4\":\"Chewbacca\",\"5\":\"http://swapi.co/api/planets/14/\",\"6\":\"http://swapi.co/api/species/3/\",\"7\":\"Kashyyyk\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/14/\",\"3\":\"The Empire Strikes Back\",\"4\":\"Han Solo\",\"5\":\"http://swapi.co/api/planets/22/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Corellia\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/18/\",\"3\":\"The Empire Strikes Back\",\"4\":\"Wedge Antilles\",\"5\":\"http://swapi.co/api/planets/22/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Corellia\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/20/\",\"3\":\"The Empire Strikes Back\",\"4\":\"Yoda\",\"5\":\"http://swapi.co/api/planets/28/\",\"6\":\"http://swapi.co/api/species/6/\",\"7\":\"unknown\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/21/\",\"3\":\"The Empire Strikes Back\",\"4\":\"Palpatine\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/22/\",\"3\":\"The Empire Strikes Back\",\"4\":\"Boba Fett\",\"5\":\"http://swapi.co/api/planets/10/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Kamino\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/23/\",\"3\":\"The Empire Strikes Back\",\"4\":\"IG-88\",\"5\":\"http://swapi.co/api/planets/28/\",\"6\":\"http://swapi.co/api/species/2/\",\"7\":\"unknown\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/24/\",\"3\":\"The Empire Strikes Back\",\"4\":\"Bossk\",\"5\":\"http://swapi.co/api/planets/29/\",\"6\":\"http://swapi.co/api/species/7/\",\"7\":\"Trandosha\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/25/\",\"3\":\"The Empire Strikes Back\",\"4\":\"Lando Calrissian\",\"5\":\"http://swapi.co/api/planets/30/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Socorro\"},{\"1\":\"http://swapi.co/api/films/2/\",\"2\":\"http://swapi.co/api/people/26/\",\"3\":\"The Empire Strikes Back\",\"4\":\"Lobot\",\"5\":\"http://swapi.co/api/planets/6/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Bespin\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/1/\",\"3\":\"The Force Awakens\",\"4\":\"Luke Skywalker\",\"5\":\"http://swapi.co/api/planets/1/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Tatooine\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/3/\",\"3\":\"The Force Awakens\",\"4\":\"R2-D2\",\"5\":\"http://swapi.co/api/planets/8/\",\"6\":\"http://swapi.co/api/species/2/\",\"7\":\"Naboo\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/5/\",\"3\":\"The Force Awakens\",\"4\":\"Leia Organa\",\"5\":\"http://swapi.co/api/planets/2/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Alderaan\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/13/\",\"3\":\"The Force Awakens\",\"4\":\"Chewbacca\",\"5\":\"http://swapi.co/api/planets/14/\",\"6\":\"http://swapi.co/api/species/3/\",\"7\":\"Kashyyyk\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/14/\",\"3\":\"The Force Awakens\",\"4\":\"Han Solo\",\"5\":\"http://swapi.co/api/planets/22/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"Corellia\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/27/\",\"3\":\"The Force Awakens\",\"4\":\"Ackbar\",\"5\":\"http://swapi.co/api/planets/31/\",\"6\":\"http://swapi.co/api/species/8/\",\"7\":\"Mon Cala\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/84/\",\"3\":\"The Force Awakens\",\"4\":\"Finn\",\"5\":\"http://swapi.co/api/planets/28/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"unknown\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/85/\",\"3\":\"The Force Awakens\",\"4\":\"Rey\",\"5\":\"http://swapi.co/api/planets/28/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"unknown\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/86/\",\"3\":\"The Force Awakens\",\"4\":\"Poe Dameron\",\"5\":\"http://swapi.co/api/planets/28/\",\"6\":\"http://swapi.co/api/species/1/\",\"7\":\"unknown\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/87/\",\"3\":\"The Force Awakens\",\"4\":\"BB8\",\"5\":\"http://swapi.co/api/planets/28/\",\"6\":\"http://swapi.co/api/species/2/\",\"7\":\"unknown\"},{\"1\":\"http://swapi.co/api/films/7/\",\"2\":\"http://swapi.co/api/people/88/\",\"3\":\"The Force Awakens\",\"4\":\"Captain Phasma\",\"5\":\"http://swapi.co/api/planets/28/\",\"6\":\"NA\",\"7\":\"unknown\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nThe `data_films_x_characters_1` can be used to plot the composition ratio of the characters' home planets, as shown below. We will not discuss this plot further. However, we have confirmed that the relational data model can be used to automate the joining of data frames.\n\nIn the above analysis, it is easy to join data frames using `left_join()`, and you may not see the advantage of using a relational data model. In the application section, we will consider a more complex situation where a relational data model prevails.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Plot of the composition of the characters' home planets\"}\ndata_films_x_characters_1 |> \n  mutate(name.planets = fct_lump_n(name.planets, 7,\n                                   ties.method = \"first\") |> \n           fct_relevel(\"Other\", \n                       after = Inf)) |> \n  count(title, name.planets) |> \n  mutate(prop = n / sum(n),\n         .by = title,\n         .keep = \"unused\") |> \n  ggplot(aes(fct_rev(title), prop,\n             fill = name.planets)) +\n  geom_col(position = position_stack(reverse = TRUE)) +\n  geom_text(aes(label = if_else(prop < 5e-2, \n                                \"\",\n                                scales::label_percent(accuracy = 1)(prop))),\n            position = position_stack(vjust = 0.5,\n                                      reverse = TRUE)) +\n  scale_x_discrete(\"Title\") +\n  scale_y_continuous(\"Composition of the characters' home planets\",\n                     labels = scales::percent) +\n  scale_fill_brewer(\"Planet Name\",\n                    palette = \"Set2\") +\n  coord_flip() +\n  theme(legend.position = \"bottom\") +\n  guides(fill = guide_legend(nrow = 2,\n                             byrow = TRUE))\n```\n\n::: {.cell-output-display}\n![](relational-data-models-with-r-s-dm-en_files/figure-html/plot-starwars-1-1.png){width=672}\n:::\n:::\n\n\n### 2. Application: Extending the model and validating keys with dm\n\nIn the application, we will examine the composition ratio of the species of the characters in Star Wars movies. The difficulty level of this analysis is not much different from that of the basic analysis. However, as the amount of data to be handled increases, the code tends to become more complicated, and the advantages of using a relational data model are significant. In addition, the advantages of the relational data model include the following,\n\n-   New data can be added to the existing relational data model\n-   Possible to check key constraints defined to join data frames\n\nWe prepare in advance the `species` data needed for this analysis.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspecies <- tibble(species = sw_species) |> \n  unnest_wider(species) |> \n  select(url, name)\n\nspecies\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"url\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"name\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"http://swapi.co/api/species/5/\",\"2\":\"Hutt\"},{\"1\":\"http://swapi.co/api/species/6/\",\"2\":\"Yoda's species\"},{\"1\":\"http://swapi.co/api/species/7/\",\"2\":\"Trandoshan\"},{\"1\":\"http://swapi.co/api/species/8/\",\"2\":\"Mon Calamari\"},{\"1\":\"http://swapi.co/api/species/9/\",\"2\":\"Ewok\"},{\"1\":\"http://swapi.co/api/species/10/\",\"2\":\"Sullustan\"},{\"1\":\"http://swapi.co/api/species/11/\",\"2\":\"Neimodian\"},{\"1\":\"http://swapi.co/api/species/12/\",\"2\":\"Gungan\"},{\"1\":\"http://swapi.co/api/species/13/\",\"2\":\"Toydarian\"},{\"1\":\"http://swapi.co/api/species/14/\",\"2\":\"Dug\"},{\"1\":\"http://swapi.co/api/species/15/\",\"2\":\"Twi'lek\"},{\"1\":\"http://swapi.co/api/species/16/\",\"2\":\"Aleena\"},{\"1\":\"http://swapi.co/api/species/17/\",\"2\":\"Vulptereen\"},{\"1\":\"http://swapi.co/api/species/18/\",\"2\":\"Xexto\"},{\"1\":\"http://swapi.co/api/species/19/\",\"2\":\"Toong\"},{\"1\":\"http://swapi.co/api/species/20/\",\"2\":\"Cerean\"},{\"1\":\"http://swapi.co/api/species/21/\",\"2\":\"Nautolan\"},{\"1\":\"http://swapi.co/api/species/22/\",\"2\":\"Zabrak\"},{\"1\":\"http://swapi.co/api/species/23/\",\"2\":\"Tholothian\"},{\"1\":\"http://swapi.co/api/species/24/\",\"2\":\"Iktotchi\"},{\"1\":\"http://swapi.co/api/species/25/\",\"2\":\"Quermian\"},{\"1\":\"http://swapi.co/api/species/26/\",\"2\":\"Kel Dor\"},{\"1\":\"http://swapi.co/api/species/27/\",\"2\":\"Chagrian\"},{\"1\":\"http://swapi.co/api/species/28/\",\"2\":\"Geonosian\"},{\"1\":\"http://swapi.co/api/species/29/\",\"2\":\"Mirialan\"},{\"1\":\"http://swapi.co/api/species/30/\",\"2\":\"Clawdite\"},{\"1\":\"http://swapi.co/api/species/31/\",\"2\":\"Besalisk\"},{\"1\":\"http://swapi.co/api/species/32/\",\"2\":\"Kaminoan\"},{\"1\":\"http://swapi.co/api/species/33/\",\"2\":\"Skakoan\"},{\"1\":\"http://swapi.co/api/species/34/\",\"2\":\"Muun\"},{\"1\":\"http://swapi.co/api/species/35/\",\"2\":\"Togruta\"},{\"1\":\"http://swapi.co/api/species/36/\",\"2\":\"Kaleesh\"},{\"1\":\"http://swapi.co/api/species/37/\",\"2\":\"Pau'an\"},{\"1\":\"http://swapi.co/api/species/3/\",\"2\":\"Wookiee\"},{\"1\":\"http://swapi.co/api/species/2/\",\"2\":\"Droid\"},{\"1\":\"http://swapi.co/api/species/1/\",\"2\":\"Human\"},{\"1\":\"http://swapi.co/api/species/4/\",\"2\":\"Rodian\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nIn dm, we can add new data to the relational data model using `dm()`. In this example, let's build `dm_starwars_2` by adding the `species` data to `dm_starwars_1`. By using `dm_draw()`, we can see that the model has been updated.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndm_starwars_2 <- dm_starwars_1 |> \n  dm(species) |> \n  dm_add_pk(species, url) |> \n  dm_add_fk(people, species, species)\n\ndm_draw(dm_starwars_2)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"grViz html-widget html-fill-item\" id=\"htmlwidget-d5c6320d67aa1865f6ac\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-d5c6320d67aa1865f6ac\">{\"x\":{\"diagram\":\"#data_model\\ndigraph {\\ngraph [rankdir=LR tooltip=\\\"Data Model\\\" ]\\n\\nnode [margin=0 fontcolor = \\\"#444444\\\" ]\\n\\nedge [color = \\\"#555555\\\", arrowsize = 1, ]\\n\\npack=true\\npackmode= \\\"node\\\"\\n\\n  \\\"films\\\" [id = \\\"films\\\", label = <<TABLE ALIGN=\\\"LEFT\\\" BORDER=\\\"1\\\" CELLBORDER=\\\"0\\\" CELLSPACING=\\\"0\\\" COLOR=\\\"#555555\\\">\\n    <TR>\\n      <TD COLSPAN=\\\"1\\\" BGCOLOR=\\\"#EFEBDD\\\" BORDER=\\\"0\\\"><FONT COLOR=\\\"#000000\\\">films<\\/FONT>\\n<\\/TD>\\n    <\\/TR>\\n    <TR>\\n      <TD ALIGN=\\\"LEFT\\\" BGCOLOR=\\\"#FFFFFF\\\" PORT=\\\"url\\\"><U>url<\\/U><\\/TD>\\n    <\\/TR>\\n  <\\/TABLE>>, shape = \\\"plaintext\\\"] \\n\\n  \\\"films_x_characters\\\" [id = \\\"films_x_characters\\\", label = <<TABLE ALIGN=\\\"LEFT\\\" BORDER=\\\"1\\\" CELLBORDER=\\\"0\\\" CELLSPACING=\\\"0\\\" COLOR=\\\"#555555\\\">\\n    <TR>\\n      <TD COLSPAN=\\\"1\\\" BGCOLOR=\\\"#EFEBDD\\\" BORDER=\\\"0\\\"><FONT COLOR=\\\"#000000\\\">films_x_characters<\\/FONT>\\n<\\/TD>\\n    <\\/TR>\\n    <TR>\\n      <TD ALIGN=\\\"LEFT\\\" BGCOLOR=\\\"#FFFFFF\\\" PORT=\\\"url\\\">url<\\/TD>\\n    <\\/TR>\\n    <TR>\\n      <TD ALIGN=\\\"LEFT\\\" BGCOLOR=\\\"#FFFFFF\\\" PORT=\\\"characters\\\">characters<\\/TD>\\n    <\\/TR>\\n    <TR>\\n      <TD ALIGN=\\\"LEFT\\\" BGCOLOR=\\\"#FFFFFF\\\" PORT=\\\"url, characters\\\"><U>url, characters<\\/U><\\/TD>\\n    <\\/TR>\\n  <\\/TABLE>>, shape = \\\"plaintext\\\"] \\n\\n  \\\"people\\\" [id = \\\"people\\\", label = <<TABLE ALIGN=\\\"LEFT\\\" BORDER=\\\"1\\\" CELLBORDER=\\\"0\\\" CELLSPACING=\\\"0\\\" COLOR=\\\"#555555\\\">\\n    <TR>\\n      <TD COLSPAN=\\\"1\\\" BGCOLOR=\\\"#EFEBDD\\\" BORDER=\\\"0\\\"><FONT COLOR=\\\"#000000\\\">people<\\/FONT>\\n<\\/TD>\\n    <\\/TR>\\n    <TR>\\n      <TD ALIGN=\\\"LEFT\\\" BGCOLOR=\\\"#FFFFFF\\\" PORT=\\\"url\\\"><U>url<\\/U><\\/TD>\\n    <\\/TR>\\n    <TR>\\n      <TD ALIGN=\\\"LEFT\\\" BGCOLOR=\\\"#FFFFFF\\\" PORT=\\\"homeworld\\\">homeworld<\\/TD>\\n    <\\/TR>\\n    <TR>\\n      <TD ALIGN=\\\"LEFT\\\" BGCOLOR=\\\"#FFFFFF\\\" PORT=\\\"species\\\">species<\\/TD>\\n    <\\/TR>\\n  <\\/TABLE>>, shape = \\\"plaintext\\\"] \\n\\n  \\\"planets\\\" [id = \\\"planets\\\", label = <<TABLE ALIGN=\\\"LEFT\\\" BORDER=\\\"1\\\" CELLBORDER=\\\"0\\\" CELLSPACING=\\\"0\\\" COLOR=\\\"#555555\\\">\\n    <TR>\\n      <TD COLSPAN=\\\"1\\\" BGCOLOR=\\\"#EFEBDD\\\" BORDER=\\\"0\\\"><FONT COLOR=\\\"#000000\\\">planets<\\/FONT>\\n<\\/TD>\\n    <\\/TR>\\n    <TR>\\n      <TD ALIGN=\\\"LEFT\\\" BGCOLOR=\\\"#FFFFFF\\\" PORT=\\\"url\\\"><U>url<\\/U><\\/TD>\\n    <\\/TR>\\n  <\\/TABLE>>, shape = \\\"plaintext\\\"] \\n\\n  \\\"species\\\" [id = \\\"species\\\", label = <<TABLE ALIGN=\\\"LEFT\\\" BORDER=\\\"1\\\" CELLBORDER=\\\"0\\\" CELLSPACING=\\\"0\\\" COLOR=\\\"#555555\\\">\\n    <TR>\\n      <TD COLSPAN=\\\"1\\\" BGCOLOR=\\\"#EFEBDD\\\" BORDER=\\\"0\\\"><FONT COLOR=\\\"#000000\\\">species<\\/FONT>\\n<\\/TD>\\n    <\\/TR>\\n    <TR>\\n      <TD ALIGN=\\\"LEFT\\\" BGCOLOR=\\\"#FFFFFF\\\" PORT=\\\"url\\\"><U>url<\\/U><\\/TD>\\n    <\\/TR>\\n  <\\/TABLE>>, shape = \\\"plaintext\\\"] \\n\\n\\\"films_x_characters\\\":\\\"url\\\"->\\\"films\\\":\\\"url\\\" [id=\\\"films_x_characters_1\\\"]\\n\\\"films_x_characters\\\":\\\"characters\\\"->\\\"people\\\":\\\"url\\\" [id=\\\"films_x_characters_2\\\"]\\n\\\"people\\\":\\\"homeworld\\\"->\\\"planets\\\":\\\"url\\\" [id=\\\"people_1\\\"]\\n\\\"people\\\":\\\"species\\\"->\\\"species\\\":\\\"url\\\" [id=\\\"people_2\\\"]\\n}\",\"config\":{\"engine\":null,\"options\":null}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\nNext, let us check key constraints to join data frames. This can be done using `dm_examine_constraints()`. Let's check the behavior of `dm_examine_constraints()` by building a model that contains the two types of mistakes mentioned above as common mistakes. Here, `dm_starwars_2_strong_data` is data in which the first row of the `species` data has been deleted and the data is not \"MECE\". `dm_starwars_2_wrong_pk` is the data with the wrong primary key in the `species` data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndm_starwars_2_wrong_data <- dm_starwars_1 |> \n  dm(species = species |> \n       slice(-1)) |> \n  dm_add_pk(species, url) |> \n  dm_add_fk(people, species, species)\n\ndm_starwars_2_wrong_pk <- dm_starwars_1 |> \n  dm(species) |> \n  dm_add_pk(species, name) |> \n  dm_add_fk(people, species, species)\n```\n:::\n\n\nLet's look at the result of `dm_examine_constraints()`. For the correct model, `dm_starwars_2`, the message `ℹ All constraints satisfied.` is displayed. On the other hand, `dm_starwars_2_strong_data` and `dm_starwars_2_strong_pk` show the message `! Unsatisfied constraints:` is displayed. This is because the primary key of the `species` data does not contain data that should be included. Thus, we see that `dm_examine_constraints()` can be used to easily check the key constraints.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprint(dm_examine_constraints(dm_starwars_2))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nℹ All constraints satisfied.\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(dm_examine_constraints(dm_starwars_2_wrong_data))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n! Unsatisfied constraints:\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n• Table `people`: foreign key `species` into table `species`: values of `people$species` not in `species$url`: http://swapi.co/api/species/5/ (1)\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(dm_examine_constraints(dm_starwars_2_wrong_pk))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n! Unsatisfied constraints:\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n• Table `people`: foreign key `species` into table `species`: values of `people$species` not in `species$name`: http://swapi.co/api/species/1/ (35), http://swapi.co/api/species/2/ (5), http://swapi.co/api/species/12/ (3), http://swapi.co/api/species/15/ (2), http://swapi.co/api/species/22/ (2), …\n```\n\n\n:::\n:::\n\n\nAs described above, we have seen that we can add new data to the relational data model with `dm()` and check key constraints with `dm_examine_constraints()`. Finally, the following figure shows a composition of the species of the characters in the Star Wars films using `dm_starwars_2`. Again, we omit the discussion of the plots.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Plot of the composition of the characters' races\"}\ndm_starwars_2 |> \n  dm_flatten_to_tbl(films_x_characters,\n                    .recursive = TRUE) |> \n  mutate(name.species = name.species |> \n           fct_na_value_to_level(\"Other\") |> \n           fct_lump_n(7,\n                      ties.method = \"first\") |> \n           fct_relevel(\"Other\", \n                       after = Inf)) |> \n  count(title, name.species) |> \n  mutate(prop = n / sum(n),\n         .by = title,\n         .keep = \"unused\") |> \n  ggplot(aes(fct_rev(title), prop,\n             fill = name.species)) +\n  geom_col(position = position_stack(reverse = TRUE)) +\n  geom_text(aes(label = if_else(prop < 5e-2, \n                                \"\",\n                                scales::label_percent(accuracy = 1)(prop))),\n            position = position_stack(vjust = 0.5,\n                                      reverse = TRUE)) +\n  scale_x_discrete(\"Title\") +\n  scale_y_continuous(\"Composition of the characters' races\",\n                     labels = scales::percent) +\n  scale_fill_brewer(\"Species name\",\n                    palette = \"Set2\") +\n  coord_flip() +\n  theme(legend.position = \"bottom\") +\n  guides(fill = guide_legend(nrow = 2,\n                             byrow = TRUE))\n```\n\n::: {.cell-output-display}\n![](relational-data-models-with-r-s-dm-en_files/figure-html/plot-starwars-2-1.png){width=672}\n:::\n:::\n\n\n## Summary\n\nIn this article, we have shown how to build a relational data model using dm. Once a relational data model is built using dm, it is no longer necessary to manage relationships among data by oneself, and data can be automatically joined using `dm_flatten_to_tbl()`. In addition, dm provides other useful functions to enhance the quality of data preprocessing, such as adding data to the model with `dm()` and checking key constraints with `dm_examine_constraints()`.\n\n## References\n\n-   [dm package site](https://dm.cynkra.com/index.html)\n-   [Preprocessing Compendium \\[Practical SQL/R/Python techniques for data analysis\\] (in Japanese)](https://gihyo.jp/book/2018/978-4-7741-9647-3)\n-   [starwarsdb](https://pkg.garrickadenbuie.com/starwarsdb/)\n    -   Star Wars relational data model available for download from CRAN\n",
    "supporting": [
      "relational-data-models-with-r-s-dm-en_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<script src=\"../../../site_libs/viz-1.8.2/viz.js\"></script>\n<link href=\"../../../site_libs/DiagrammeR-styles-0.2/styles.css\" rel=\"stylesheet\" />\n<script src=\"../../../site_libs/grViz-binding-1.0.10/grViz.js\"></script>\n<link href=\"../../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}